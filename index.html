<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ostend Is Music 2025 Expertenhub</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: #f8f9fa;
        min-height: 100vh;
        padding: 20px;
        color: #333;
        line-height: 1.5;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 8px;
        padding: 40px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      h1 {
        text-align: center;
        margin-bottom: 20px;
        color: #2c3e50;
        font-size: 1.8rem;
        font-weight: 500;
      }

      h2 {
        text-align: center;
        margin-bottom: 20px;
        color: #34495e;
        font-size: 1.3rem;
        font-weight: 500;
        border-bottom: 1px solid #ecf0f1;
        padding-bottom: 10px;
      }

      h3 {
        margin-bottom: 15px;
        color: #2c3e50;
        font-size: 1.1rem;
        font-weight: 500;
      }

      .section {
        margin-bottom: 30px;
        padding: 20px;
        background: #fafbfc;
        border-radius: 6px;
        border: 1px solid #e1e8ed;
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
      }

      label {
        margin-bottom: 5px;
        font-weight: 500;
        color: #555;
        font-size: 0.9rem;
      }

      input,
      select,
      button {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 0.9rem;
        transition: border-color 0.2s ease;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: #3498db;
      }

      button {
        background: #3498db;
        color: white;
        border: none;
        cursor: pointer;
        font-weight: 500;
        transition: background-color 0.2s ease;
      }

      button:hover {
        background: #2980b9;
      }

      button:disabled {
        background: #bdc3c7;
        cursor: not-allowed;
      }

      .btn-secondary {
        background: #95a5a6;
      }

      .btn-secondary:hover {
        background: #7f8c8d;
      }

      .btn-danger {
        background: #e74c3c;
      }

      .btn-danger:hover {
        background: #c0392b;
      }

      .btn-success {
        background: #27ae60;
      }

      .btn-success:hover {
        background: #229954;
      }

      .admin-access-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 40px;
        height: 40px;
        background: #95a5a6;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        font-size: 14px;
        color: white;
        transition: background-color 0.2s ease;
        z-index: 100;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      }

      .admin-access-btn:hover {
        background: #7f8c8d;
      }

      .client-booking-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .client-table-card {
        background: white;
        border-radius: 6px;
        padding: 20px;
        border: 1px solid #e1e8ed;
        transition: box-shadow 0.2s ease;
      }

      .client-table-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .table-header {
        text-align: center;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid #ecf0f1;
      }

      .table-title {
        font-size: 1.1rem;
        font-weight: 500;
        color: #2c3e50;
        margin-bottom: 5px;
      }

      .speakers {
        font-size: 0.9rem;
        color: #7f8c8d;
      }

      .time-slots-container {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .time-slot-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 12px;
        border-radius: 4px;
        border: 1px solid #ddd;
        transition: all 0.2s ease;
      }

      .time-slot-item.available {
        background: #f8fff9;
        border-color: #27ae60;
      }

      .time-slot-item.available:hover {
        background: #e8f5e8;
      }

      .time-slot-item.booked {
        background: #fdf2f2;
        border-color: #e74c3c;
      }

      .time-info {
        font-weight: 500;
        color: #2c3e50;
        font-size: 0.9rem;
      }

      .slot-btn {
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
        font-size: 0.8rem;
        transition: background-color 0.2s ease;
      }

      .slot-btn.available {
        background: #27ae60;
        color: white;
      }

      .slot-btn.available:hover {
        background: #229954;
      }

      .slot-btn.booked {
        background: #bdc3c7;
        color: #7f8c8d;
        cursor: not-allowed;
      }

      .modal {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 25px;
        border-radius: 6px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        min-width: 350px;
        max-width: 500px;
      }

      .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
      }

      .close-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: none;
        border: none;
        font-size: 18px;
        cursor: pointer;
        color: #7f8c8d;
      }

      .status-message {
        padding: 10px;
        border-radius: 4px;
        margin-top: 10px;
        text-align: center;
        font-size: 0.9rem;
      }

      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .warning {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }

      .nav-tabs {
        display: flex;
        margin-bottom: 20px;
        border-bottom: 1px solid #dee2e6;
      }

      .nav-tab {
        padding: 10px 20px;
        background: none;
        border: none;
        border-bottom: 2px solid transparent;
        cursor: pointer;
        font-weight: 500;
        color: #6c757d;
        transition: all 0.2s ease;
      }

      .nav-tab.active {
        color: #3498db;
        border-bottom-color: #3498db;
      }

      .nav-tab:hover {
        color: #3498db;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .admin-interface {
        display: none;
      }

      .client-interface {
        display: block;
      }

      .tables-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .table-card {
        padding: 15px;
        border: 1px solid #e1e8ed;
        border-radius: 6px;
        background: white;
      }

      .bookings-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        font-size: 0.9rem;
      }

      .bookings-table th,
      .bookings-table td {
        padding: 10px;
        border: 1px solid #dee2e6;
        text-align: left;
      }

      .bookings-table th {
        background: #f8f9fa;
        font-weight: 500;
      }

      .bookings-table tr:nth-child(even) {
        background: #f8f9fa;
      }

      .event-info {
        text-align: center;
        margin-bottom: 20px;
        color: #6c757d;
        font-size: 0.95rem;
      }

      .booking-actions {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }

      .confirmation-details {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
        margin: 15px 0;
        border: 1px solid #e9ecef;
      }

      .email-preview {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
        margin-top: 15px;
        border: 1px solid #e9ecef;
      }

      .hidden {
        display: none;
      }

      .admin-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .admin-user-info {
        display: flex;
        align-items: center;
        gap: 15px;
        color: #666;
        font-size: 0.9rem;
      }

      .connection-status {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.7rem;
        font-weight: 400;
        z-index: 200;
        transition: all 0.3s ease;
        opacity: 0.7;
      }

      .connection-status.connected {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .connection-status.disconnected {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .sync-indicator {
        display: inline-block;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        margin-right: 6px;
        animation: pulse 2s infinite;
      }

      .sync-indicator.syncing {
        background: #ffc107;
      }

      .sync-indicator.synced {
        background: #28a745;
      }

      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
      }

      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.9);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        font-size: 1.2rem;
        color: #666;
      }

      .firebase-config-section {
        background: #e7f3ff;
        border: 1px solid #b3d4fc;
        padding: 15px;
        border-radius: 4px;
        margin-bottom: 20px;
      }

      .firebase-config-section h3 {
        color: #0c5aa6;
        margin-bottom: 10px;
      }

      .config-form {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 15px;
      }

      .config-form input {
        font-size: 0.8rem;
        padding: 8px;
      }

      .config-actions {
        display: flex;
        gap: 10px;
      }

      .auth-section {
        background: #f0f8ff;
        border: 1px solid #b3d4fc;
        padding: 15px;
        border-radius: 4px;
        margin-bottom: 20px;
      }

      .auth-section h3 {
        color: #0c5aa6;
        margin-bottom: 10px;
      }

      .auth-form {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 15px;
      }

      .auth-actions {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .user-management {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        padding: 15px;
        border-radius: 4px;
        margin-bottom: 20px;
      }

      .user-management h3 {
        color: #856404;
        margin-bottom: 10px;
      }

.export-container {
  position: fixed;
  top: -9999px;
  left: -9999px;
  width: 210mm;
  max-width: 210mm;
  min-height: 297mm;
  background: white;
  padding: 15mm;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  line-height: 1.4;
  box-sizing: border-box;
  font-size: 14px;
}

.export-header {
  text-align: center;
  margin-bottom: 25px;
  border-bottom: 3px solid #2c3e50;
  padding-bottom: 15px;
}

.export-title {
  font-size: 28px;
  font-weight: bold;
  color: #2c3e50;
  margin-bottom: 8px;
}

.export-subtitle {
  font-size: 16px;
  color: #666;
  margin-bottom: 4px;
}

.export-table {
  margin-bottom: 25px;
  border: 2px solid #ddd;
  border-radius: 8px;
  overflow: hidden;
  break-inside: avoid;
}

.export-table-header {
  background: #f8f9fa;
  padding: 15px 20px;
  border-bottom: 2px solid #ddd;
}

.export-table-name {
  font-size: 20px;
  font-weight: bold;
  color: #2c3e50;
  margin-bottom: 6px;
}

.export-table-speakers {
  font-size: 16px;
  color: #666;
}

.export-slots {
  padding: 0;
}

.export-slot {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 20px;
  border-bottom: 1px solid #f0f0f0;
  font-size: 16px;
  min-height: 50px;
}

.export-slot:last-child {
  border-bottom: none;
}

.export-slot.booked {
  background: #fff3cd;
  border-left: 6px solid #ffc107;
}

.export-slot.available {
  background: #d4edda;
  border-left: 6px solid #28a745;
}

.export-time {
  font-weight: bold;
  color: #2c3e50;
  min-width: 120px;
  font-size: 16px;
}

.export-booking-info {
  flex: 1;
  text-align: center;
  font-weight: bold;
  font-size: 16px;
}

.export-booking-info.booked {
  color: #856404;
}

.export-booking-info.available {
  color: #155724;
  font-style: italic;
}

.export-summary {
  margin-top: 25px;
  padding: 20px;
  background: #f8f9fa;
  border-radius: 8px;
  border: 2px solid #e9ecef;
  page-break-inside: avoid;
}

.export-summary h4 {
  color: #2c3e50;
  margin-bottom: 15px;
  font-size: 20px;
}

.export-summary-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
  font-size: 16px;
}

.export-summary-item {
  padding: 8px 0;
}
      .export-summary-item {
  padding: 8px 0;
}

/* 4K Signage Export Styles */
.signage-container {
  position: fixed;
  top: -9999px;
  left: -9999px;
  width: 3840px;
  height: 2160px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 60px;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  box-sizing: border-box;
  color: white;
  overflow: hidden;
}

.signage-header {
  text-align: center;
  margin-bottom: 40px;
  border-bottom: 4px solid rgba(255, 255, 255, 0.3);
  padding-bottom: 30px;
}

.signage-title {
  font-size: 72px;
  font-weight: bold;
  margin-bottom: 15px;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.signage-subtitle {
  font-size: 36px;
  margin-bottom: 8px;
  opacity: 0.9;
}

.signage-tables-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(480px, 1fr));
  gap: 30px;
  margin-bottom: 40px;
}

.signage-table {
  background: rgba(255, 255, 255, 0.95);
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
  color: #333;
}

.signage-table-header {
  background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
  padding: 20px;
  color: white;
  text-align: center;
}

.signage-table-name {
  font-size: 28px;
  font-weight: bold;
  margin-bottom: 8px;
}

.signage-table-speakers {
  font-size: 20px;
  opacity: 0.9;
}

.signage-slots {
  padding: 15px;
  max-height: 600px;
  overflow-y: auto;
}

.signage-slot {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  margin-bottom: 8px;
  border-radius: 8px;
  font-size: 18px;
  min-height: 50px;
}

.signage-slot.available {
  background: #d4edda;
  border-left: 6px solid #28a745;
}

.signage-slot.booked {
  background: #fff3cd;
  border-left: 6px solid #ffc107;
}

.signage-time {
  font-weight: bold;
  font-size: 20px;
  min-width: 140px;
}

.signage-booking-info {
  flex: 1;
  text-align: center;
  font-weight: bold;
  font-size: 18px;
}

.signage-booking-info.booked {
  color: #856404;
}

.signage-booking-info.available {
  color: #155724;
  font-style: italic;
}

.signage-footer {
  position: absolute;
  bottom: 60px;
  left: 60px;
  right: 60px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: rgba(255, 255, 255, 0.1);
  padding: 20px 30px;
  border-radius: 12px;
  backdrop-filter: blur(10px);
}

.signage-stats {
  display: flex;
  gap: 40px;
  font-size: 24px;
}

.signage-stat {
  text-align: center;
}

.signage-stat-number {
  font-size: 32px;
  font-weight: bold;
  display: block;
}

.signage-generated {
  font-size: 20px;
  opacity: 0.8;
}
      /* Realtime Signage Display Styles */
.signage-fullscreen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  z-index: 10000;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  color: white;
  overflow: hidden;
  display: none;
}

.signage-fullscreen.active {
  display: block;
}

.signage-controls {
  position: absolute;
  top: 20px;
  right: 20px;
  z-index: 10001;
  display: flex;
  gap: 10px;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.signage-fullscreen:hover .signage-controls {
  opacity: 1;
}

.signage-control-btn {
  background: rgba(255, 255, 255, 0.2);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  padding: 8px 12px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
  backdrop-filter: blur(10px);
  transition: background 0.2s ease;
}

.signage-control-btn:hover {
  background: rgba(255, 255, 255, 0.3);
}

.signage-refresh-indicator {
  position: absolute;
  top: 20px;
  left: 20px;
  background: rgba(255, 255, 255, 0.1);
  padding: 8px 12px;
  border-radius: 20px;
  font-size: 14px;
  backdrop-filter: blur(10px);
  display: flex;
  align-items: center;
  gap: 8px;
}

.signage-refresh-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #28a745;
  animation: pulse 2s infinite;
}

.signage-refresh-dot.updating {
  background: #ffc107;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.signage-content {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  padding: 40px 60px;
  box-sizing: border-box;
}

.signage-realtime-header {
  text-align: center;
  margin-bottom: 30px;
  border-bottom: 4px solid rgba(255, 255, 255, 0.4);
  padding-bottom: 25px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  backdrop-filter: blur(10px);
  padding: 25px;
}

.signage-realtime-title {
  font-size: clamp(48px, 5vw, 72px);
  font-weight: bold;
  margin-bottom: 10px;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.signage-realtime-subtitle {
  font-size: clamp(24px, 2.5vw, 36px);
  margin-bottom: 5px;
  opacity: 0.9;
}

.signage-realtime-tables {
  flex: 1;
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 30px;
  margin-bottom: 30px;
  overflow-y: auto;
  padding: 0 20px;
  max-height: calc(100vh - 400px);
}

.signage-realtime-table {
  background: rgba(255, 255, 255, 0.98);
  border-radius: 16px;
  overflow: visible;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  color: #333;
  height: auto;
  min-height: 400px;
  border: 2px solid rgba(255, 255, 255, 0.2);
  display: flex;
  flex-direction: column;
}

.signage-realtime-table-header {
  background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
  padding: 20px;
  color: white;
  text-align: center;
  border-bottom: 3px solid rgba(255, 255, 255, 0.1);
}

.signage-realtime-table-name {
  font-size: clamp(20px, 2vw, 28px);
  font-weight: bold;
  margin-bottom: 8px;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
  line-height: 1.2;
}

.signage-realtime-table-speakers {
  font-size: clamp(16px, 1.4vw, 20px);
  opacity: 0.95;
  font-weight: 500;
  line-height: 1.3;
}

.signage-realtime-slots {
  padding: 15px;
  max-height: none !important;
  overflow: visible !important;
  background: #fafbfc;
  display: block !important;
  min-height: 200px;
}

.signage-realtime-slot {
  display: flex !important;
  justify-content: space-between;
  align-items: center;
  padding: 10px 15px;
  margin-bottom: 6px;
  border-radius: 8px;
  font-size: 14px;
  min-height: 40px;
  transition: all 0.2s ease;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  width: 100%;
  box-sizing: border-box;
}

.signage-realtime-slot.available {
  background: linear-gradient(135deg, #d4f6d4 0%, #c8f0c8 100%);
  border-left: 6px solid #28a745;
  border: 2px solid #28a745;
}

.signage-realtime-slot.booked {
  background: linear-gradient(135deg, #fff8cd 0%, #ffeaa7 100%);
  border-left: 6px solid #f39c12;
  border: 2px solid #f39c12;
}

.signage-realtime-time {
  font-weight: bold;
  min-width: 120px;
  font-size: clamp(14px, 1.2vw, 18px);
  color: #2c3e50;
  background: rgba(255, 255, 255, 0.8);
  padding: 4px 8px;
  border-radius: 4px;
  text-align: center;
}

.signage-realtime-booking-info {
  flex: 1;
  text-align: center;
  font-weight: bold;
  font-size: clamp(13px, 1.1vw, 16px);
  margin-left: 15px;
  padding: 6px 12px;
  border-radius: 6px;
  line-height: 1.3;
}

.signage-realtime-booking-info.booked {
  color: #8b4513;
  background: rgba(255, 255, 255, 0.9);
  border: 1px solid #f39c12;
}

.signage-realtime-booking-info.available {
  color: #155724;
  font-style: italic;
  background: rgba(255, 255, 255, 0.9);
  border: 1px solid #28a745;
}

.signage-realtime-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: rgba(255, 255, 255, 0.1);
  padding: 15px 25px;
  border-radius: 8px;
  backdrop-filter: blur(10px);
}

.signage-realtime-stats {
  display: flex;
  gap: 30px;
  font-size: clamp(16px, 1.5vw, 24px);
}

.signage-realtime-stat {
  text-align: center;
}

.signage-realtime-stat-number {
  font-size: clamp(20px, 2vw, 32px);
  font-weight: bold;
  display: block;
}

.signage-realtime-generated {
  font-size: clamp(14px, 1.2vw, 20px);
  opacity: 0.8;
}
      /* Verbeterde responsive grid */
@media (min-width: 1920px) {
  .signage-realtime-tables {
    grid-template-columns: repeat(4, 1fr);
    gap: 30px;
  }
}

@media (min-width: 2560px) {
  .signage-realtime-tables {
    grid-template-columns: repeat(5, 1fr);
    gap: 35px;
  }
}

@media (max-width: 1400px) {
  .signage-realtime-tables {
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
  }
}
    </style>
  </head>
  <body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
      <div>
        <div class="sync-indicator syncing"></div>
        Laden...
      </div>
    </div>

    <!-- Connection Status -->
    <div id="connectionStatus" class="connection-status disconnected">
      <span class="sync-indicator syncing"></span>‚óã
    </div>

    <div class="container">
      <!-- CLIENT INTERFACE -->
      <div id="client-interface" class="client-interface">
        <h1>Ostend Is Music Sectordag 2025</h1>
        <h2>Expertenhub: boek je gesprekstafel(s)!</h2>
        <div class="event-info" id="eventInfo">Evenement informatie wordt geladen...</div>
        <div class="client-booking-grid" id="clientBookingGrid">
          Beschikbare tijdslots worden geladen...
        </div>
      </div>

      <!-- ADMIN ACCESS BUTTON -->
      <button
        class="admin-access-btn"
        onclick="showLoginModal()"
        title="Admin Toegang"
      >
        ‚öô
      </button>

      <!-- ADMIN INTERFACE -->
      <div id="admin-interface" class="admin-interface">
        <div class="admin-header">
          <h1>Admin Dashboard</h1>
<div class="admin-user-info">
  <span id="adminUserEmail"></span>
  <div style="display: flex; gap: 10px;">
    <button onclick="logout()" class="btn-secondary">Uitloggen</button>
    <button onclick="logoutEverywhere()" class="btn-danger" style="font-size: 0.8rem; padding: 4px 8px;">Uitloggen Overal</button>
    <button onclick="switchToClient()" class="btn-secondary">Terug naar Boekingen</button>
  </div>
</div>

        <!-- FIREBASE CONFIGURATION SECTION -->
        <div class="firebase-config-section">
          <h3>Firebase Configuratie</h3>
          <p style="margin-bottom: 15px; font-size: 0.9rem; color: #0c5aa6;">
            <strong>‚úÖ Firebase is al geconfigureerd!</strong> Uw "ostend-is-music" project is klaar voor realtime synchronisatie.<br>
            U kunt de configuratie hieronder bijwerken indien nodig, of de huidige setup blijven gebruiken.
          </p>
          
          <details style="margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 4px; border: 1px solid #e1e8ed;">
            <summary style="cursor: pointer; font-weight: 500; color: #2c3e50;">Hoe Firebase Configuratie te verkrijgen</summary>
            <div style="margin-top: 10px; font-size: 0.85rem; line-height: 1.4;">
              <ol>
                <li>Ga naar <a href="https://console.firebase.google.com" target="_blank">Firebase Console</a></li>
                <li>Maak een nieuw project aan of selecteer een bestaand project</li>
                <li>Ga naar Project Instellingen (tandwiel icoon) ‚Üí Algemeen tabblad</li>
                <li>Scroll naar beneden naar "Uw apps" sectie</li>
                <li>Voeg een web app toe of selecteer een bestaande web app</li>
                <li>Kopieer de configuratiewaarden uit het Firebase SDK snippet</li>
                <li><strong>Vergeet niet Firestore Database en Authentication in te schakelen!</strong></li>
              </ol>
            </div>
          </details>
          
          <div class="config-form">
            <input type="text" id="firebaseApiKey" placeholder="Firebase API Sleutel" />
            <input type="text" id="firebaseAuthDomain" placeholder="Auth Domein (project-id.firebaseapp.com)" />
            <input type="text" id="firebaseProjectId" placeholder="Project ID" />
            <input type="text" id="firebaseStorageBucket" placeholder="Storage Bucket" />
            <input type="text" id="firebaseMessagingSenderId" placeholder="Messaging Sender ID" />
            <input type="text" id="firebaseAppId" placeholder="App ID" />
          </div>
          <div class="config-actions">
            <button onclick="updateFirebaseConfig()" class="btn-success">Configuratie Bijwerken</button>
            <button onclick="testFirebaseConnection()" class="btn-secondary">Verbinding Testen</button>
            <button onclick="resetToDemo()" class="btn-secondary">Config Wissen (Offline Modus)</button>
          </div>
          <div id="firebaseConfigStatus" class="status-message" style="display: none"></div>
        </div>

        <!-- EMAILJS CONFIGURATION SECTION -->
        <div class="firebase-config-section" style="background: #f0f8ff;">
          <h3>EmailJS Configuratie</h3>
          <p style="margin-bottom: 15px; font-size: 0.9rem; color: #0c5aa6;">
            Configureer EmailJS om automatisch boekingsbevestigingen naar gebruikers te sturen.
          </p>
          
          <details style="margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 4px; border: 1px solid #e1e8ed;">
            <summary style="cursor: pointer; font-weight: 500; color: #2c3e50;">Hoe EmailJS Configuratie te verkrijgen</summary>
            <div style="margin-top: 10px; font-size: 0.85rem; line-height: 1.4;">
              <ol>
                <li>Ga naar <a href="https://www.emailjs.com" target="_blank">EmailJS.com</a> en maak een gratis account aan</li>
                <li>Maak een e-mailservice aan (Gmail, Outlook, etc.)</li>
                <li>Maak een e-mailtemplate aan met deze variabelen: {{user_name}}, {{user_email}}, {{artist_name}}, {{table_name}}, {{speakers}}, {{event_date}}, {{time_slot}}</li>
                <li>Verkrijg uw Service ID vanaf de Email Services pagina</li>
                <li>Verkrijg uw Template ID vanaf de Email Templates pagina</li>
                <li>Verkrijg uw Public Key vanaf Account Settings ‚Üí API Keys</li>
              </ol>
            </div>
          </details>
          
          <div class="config-form">
            <input type="text" id="emailServiceId" placeholder="EmailJS Service ID" />
            <input type="text" id="emailTemplateId" placeholder="EmailJS Template ID" />
            <input type="text" id="emailPublicKey" placeholder="EmailJS Public Key" />
            <input type="text" id="emailFromName" placeholder="Afzender Naam (bijv. Event Team)" />
          </div>
          <div class="config-actions">
            <button onclick="updateEmailConfig()" class="btn-success">E-mail Configuratie Bijwerken</button>
            <button onclick="testEmailConfig()" class="btn-secondary">Test E-mail Versturen</button>
          </div>
          <div id="emailConfigStatus" class="status-message" style="display: none"></div>
        </div>

        <!-- USER MANAGEMENT SECTION -->
        <div class="user-management">
          <h3>Admin Gebruikersbeheer</h3>
          <p style="margin-bottom: 15px; font-size: 0.9rem;">
            Maak admin gebruikers aan die toegang hebben tot dit dashboard. Gebruikers ontvangen een e-mail om hun wachtwoord in te stellen.
          </p>
          <div class="auth-form">
            <input type="email" id="newUserEmail" placeholder="Admin E-mail" />
            <input type="password" id="newUserPassword" placeholder="Tijdelijk Wachtwoord (min 6 tekens)" />
          </div>
          <div class="auth-actions">
            <button onclick="createAdminUser()" class="btn-success">Admin Gebruiker Aanmaken</button>
            <button onclick="changePassword()" class="btn-secondary">Mijn Wachtwoord Wijzigen</button>
          </div>
          <div id="userManagementStatus" class="status-message" style="display: none"></div>
        </div>

        <div class="nav-tabs">
          <button class="nav-tab active" onclick="switchTab('setup')">
            Evenement Instellen
          </button>
          <button class="nav-tab" onclick="switchTab('bookings')">
            Boekingen Beheren
          </button>
          <button class="nav-tab" onclick="switchTab('export')">
            Exporteren & Rapporten
          </button>
        </div>

        <div id="setup-tab" class="tab-content active">
          <div class="section">
            <h2>Evenement Configuratie</h2>
            <div class="form-grid">
              <div class="form-group">
                <label for="eventDate">Evenement Datum:</label>
                <input type="date" id="eventDate" />
              </div>
              <div class="form-group">
                <label for="startTime">Starttijd:</label>
                <input type="time" id="startTime" value="09:00" />
              </div>
              <div class="form-group">
                <label for="endTime">Eindtijd:</label>
                <input type="time" id="endTime" value="17:00" />
              </div>
              <div class="form-group">
                <label for="slotDuration">Tijdslot Duur (minuten):</label>
                <input
                  type="number"
                  id="slotDuration"
                  value="10"
                  min="5"
                  max="30"
                />
              </div>
            </div>
            <button onclick="generateTimeSlots()">Tijdslots Genereren</button>
            <div
              id="eventStatus"
              class="status-message"
              style="display: none"
            ></div>
          </div>

          <div class="section">
            <h2>Tafel Configuratie</h2>
            <div class="form-grid">
              <div class="form-group">
                <label for="tableName">Tafel Naam:</label>
                <input
                  type="text"
                  id="tableName"
                  placeholder="bijv. AI & Technologie"
                />
              </div>
              <div class="form-group">
                <label for="speaker1">Spreker 1:</label>
                <input type="text" id="speaker1" placeholder="Spreker naam" />
              </div>
              <div class="form-group">
                <label for="speaker2">Spreker 2:</label>
                <input type="text" id="speaker2" placeholder="Spreker naam" />
              </div>
            </div>
            <button onclick="addTable()">Tafel Toevoegen</button>

            <div class="tables-grid" id="tablesGrid"></div>
          </div>
        </div>

        <div id="bookings-tab" class="tab-content">
          <div class="section">
            <h2>Huidige Boekingen</h2>
            <div id="bookingsOverview">Boekingen worden geladen...</div>
          </div>
        </div>

        <div id="export-tab" class="tab-content">
          <div class="section">
            <h2>Exporteren & Rapporten</h2>
            <button class="btn-success" onclick="exportToCSV()">
              Exporteren naar CSV
            </button>
            <button
              class="btn-success"
              onclick="exportToExcel()"
              style="margin-left: 10px"
            >
              Exporteren naar Excel
            </button>
<button
  class="btn-success"
  onclick="exportToJPG()"
  style="margin-left: 10px"
>
  Exporteren naar JPG (Printbaar)
</button>
<button
  class="btn-success"
  onclick="exportTo4KSignage()"
  style="margin-left: 10px"
>
  Exporteren naar 4K Signage (TV)
</button>
            <div
              id="exportStatus"
              class="status-message"
              style="display: none"
            ></div>
            <div class="section">
            <h2>Realtime 4K Signage Beheer</h2>
            <p style="margin-bottom: 15px; color: #666; font-size: 0.9rem;">
              Beheer de realtime 4K signage display voor TV-schermen. De signage wordt automatisch bijgewerkt wanneer er nieuwe boekingen binnenkomen.
            </p>
            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;">
              <button class="btn-success" onclick="openSignageDisplay()">
                üñ•Ô∏è Open Signage Display
              </button>
              <button class="btn-secondary" onclick="copySignageURL()">
                üìã Kopieer Signage URL
              </button>
              <button class="btn-secondary" onclick="toggleSignageAutoRefresh()">
                üîÑ <span id="autoRefreshStatus">Auto-refresh AAN</span>
              </button>
              <button class="btn-secondary" onclick="refreshSignageNow()">
                ‚ö° Nu Verversen
              </button>
            </div>
            <div class="form-grid" style="max-width: 600px;">
              <div class="form-group">
                <label for="signageRefreshInterval">Auto-refresh Interval (seconden):</label>
                <input type="number" id="signageRefreshInterval" value="30" min="10" max="300" />
              </div>
              <div class="form-group">
                <label for="signageTitle">Signage Titel:</label>
                <input type="text" id="signageTitle" value="Planning Expertenhub" placeholder="Aangepaste titel voor signage" />
              </div>
            </div>
            <div style="background: #e7f3ff; border: 1px solid #b3d4fc; padding: 15px; border-radius: 4px; margin-top: 15px;">
              <h4 style="color: #0c5aa6; margin-bottom: 10px;">üí° Instructies voor TV Setup:</h4>
              <ol style="font-size: 0.9rem; margin-left: 20px; color: #0c5aa6;">
                <li>Klik op "Open Signage Display" om het scherm te openen</li>
                <li>Zet de browser op volledig scherm (F11)</li>
                <li>Verbind de computer met de TV via HDMI</li>
                <li>Stel de TV in op de juiste HDMI-ingang</li>
                <li>De signage wordt automatisch bijgewerkt bij nieuwe boekingen</li>
              </ol>
            </div>
            <div
              id="signageStatus"
              class="status-message"
              style="display: none"
            ></div>
          </div>
          </div>
        </div>
      </div>

      <!-- MODALS -->
      <div class="overlay" id="overlay"></div>

<div class="modal" id="loginModal">
  <form onsubmit="loginAdmin(); return false;">
    <h3>Admin Inloggen</h3>
    <div class="form-group">
      <label for="adminEmail">E-mail:</label>
      <input type="email" id="adminEmail" placeholder="Voer admin e-mail in" style="width: 100%; margin-bottom: 15px" required />
    </div>
    <div class="form-group">
      <label for="adminPassword">Wachtwoord:</label>
      <input type="password" id="adminPassword" placeholder="Voer wachtwoord in" onkeypress="if(event.key==='Enter') loginAdmin()" style="width: 100%; margin-bottom: 15px" required />
    </div>
    <!-- ‚úÖ NIEUWE REMEMBER ME CHECKBOX -->
    <div class="form-group" style="margin-bottom: 15px;">
      <label style="display: flex; align-items: center; gap: 8px; font-size: 0.9rem; cursor: pointer;">
        <input type="checkbox" id="rememberMe" style="margin: 0;">
        <span>Onthoud mij op dit apparaat</span>
      </label>
      <small style="color: #666; font-size: 0.8rem; margin-left: 20px;">
        Blijf ingelogd voor 30 dagen (alleen op vertrouwde apparaten)
      </small>
    </div>
    <div style="text-align: center">
      <button type="submit" style="margin-right: 10px">Inloggen</button>
      <button type="button" onclick="closeLoginModal()" class="btn-secondary">Annuleren</button>
    </div>
    <div id="loginError" class="status-message error" style="display: none"></div>
  </form>
</div>

      <!-- PASSWORD CHANGE MODAL -->
      <div class="modal" id="passwordChangeModal">
        <form onsubmit="updatePassword(); return false;">
          <h3>Wachtwoord Wijzigen</h3>
          <div class="form-group">
            <label for="currentPassword">Huidige Wachtwoord:</label>
            <input
              type="password"
              id="currentPassword"
              placeholder="Voer huidige wachtwoord in"
              style="width: 100%; margin-bottom: 15px"
              required
            />
          </div>
          <div class="form-group">
            <label for="newPassword">Nieuwe Wachtwoord:</label>
            <input
              type="password"
              id="newPassword"
              placeholder="Voer nieuw wachtwoord in (min 6 tekens)"
              style="width: 100%; margin-bottom: 15px"
              minlength="6"
              required
            />
          </div>
          <div class="form-group">
            <label for="confirmPassword">Bevestig Wachtwoord:</label>
            <input
              type="password"
              id="confirmPassword"
              placeholder="Bevestig nieuw wachtwoord"
              style="width: 100%; margin-bottom: 15px"
              minlength="6"
              required
            />
          </div>
          <div style="text-align: center">
            <button type="submit" style="margin-right: 10px">
              Wachtwoord Bijwerken
            </button>
            <button type="button" onclick="closePasswordChangeModal()" class="btn-secondary">
              Annuleren
            </button>
          </div>
          <div
            id="passwordChangeStatus"
            class="status-message"
            style="display: none"
          ></div>
        </form>
      </div>

      <!-- BOOKING FORM -->
      <div class="modal" id="bookingForm">
        <button class="close-btn" onclick="closeBookingForm()">&times;</button>
        <form onsubmit="confirmBooking(); return false;">
          <h3>Boek Uw Gesprek</h3>
          <div class="form-group">
            <label for="userName">Uw Naam: *</label>
            <input type="text" id="userName" required />
          </div>
          <div class="form-group">
            <label for="userEmail">E-mail: *</label>
            <input type="email" id="userEmail" required onblur="checkEmailBookingLimit()" />
            <div id="emailBookingStatus" class="status-message" style="display: none; margin-top: 5px; text-align: left; padding: 5px;"></div>
          </div>
          <div class="form-group">
            <label for="userArtistName">Artiest Naam/Band: *</label>
            <input type="text" id="userArtistName" required />
          </div>
          <div class="form-group">
            <label>Geselecteerd Tijdslot:</label>
            <div id="selectedSlotInfo" class="confirmation-details"></div>
          </div>
          <div class="booking-actions">
            <button type="submit" id="confirmBookingBtn">Boeking Bevestigen</button>
          </div>
          <div
            id="bookingStatus"
            class="status-message"
            style="display: none"
          ></div>
        </form>
      </div>

      <!-- CONFIRMATION MODAL -->
      <div class="modal" id="confirmationModal">
        <button class="close-btn" onclick="closeConfirmationModal()">
          &times;
        </button>
        <h3>Boeking Bevestigd</h3>
        <div id="confirmationDetails"></div>
        <div class="booking-actions">
          <button onclick="addToCalendar()">Toevoegen aan Kalender</button>
          <button onclick="showEmailPreview()" class="btn-secondary">
            E-mail Bevestiging Bekijken
          </button>
        </div>
        <div id="emailPreview" class="email-preview hidden"></div>
      </div>
    </div>

    <!-- Hidden container for export -->
    <div id="exportContainer" class="export-container"></div>

    <!-- Realtime Signage Fullscreen Display -->
<div id="signageFullscreen" class="signage-fullscreen">
  <div class="signage-controls">
    <button class="signage-control-btn" onclick="exitSignageDisplay()">Sluiten</button>
    <button class="signage-control-btn" onclick="refreshSignageNow()">Verversen</button>
    <button class="signage-control-btn" onclick="toggleSignageAutoRefresh()">
      <span id="signageAutoRefreshBtn">Auto: ON</span>
    </button>
  </div>
  
  <div class="signage-refresh-indicator">
    <div class="signage-refresh-dot" id="signageRefreshDot"></div>
    <span id="signageRefreshText">Live</span>
  </div>
  
  <div class="signage-content" id="signageContent">
    <!-- Content will be dynamically generated -->
  </div>
</div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <!-- EmailJS SDK -->
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"
    ></script>
    
<!-- html2canvas SDK -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
      // Firebase and Database Configuration
      let db = null;
      let auth = null;
      let isFirebaseInitialized = false;
      let isOnline = false;
      let unsubscribeListeners = [];
      let currentUser = null;

      // Your Firebase configuration
      const DEFAULT_FIREBASE_CONFIG = {
        apiKey: "AIzaSyDTG9ciegpaJBvy4LZt9s9TdemnNAyz1EQ",
        authDomain: "ostend-is-music.firebaseapp.com",
        projectId: "ostend-is-music",
        storageBucket: "ostend-is-music.firebasestorage.app",
        messagingSenderId: "481655541764",
        appId: "1:481655541764:web:60b142aafa966c24466551",
        measurementId: "G-PH6EPPW3BY"
      };

      // EmailJS Configuration
      let EMAILJS_CONFIG = {
        serviceId: "service_0m2owju", // Replace with your EmailJS service ID
        templateId: "template_7xq3pho", // Replace with your EmailJS template ID
        publicKey: "VehBeO9qQGs5TbvvnY", // Replace with your EmailJS public key
        fromName: "Event Team"
      };

      // Global data storage (fallback for offline mode)
      let localData = {
        eventConfig: {
          date: "",
          startTime: "09:00",
          endTime: "17:00",
          slotDuration: 10,
          timeSlots: [],
        },
        tables: [],
        bookings: {}
      };

      // Constants
      const MAX_BOOKINGS_PER_EMAIL = 3;
      let currentBookingConfirmation = null;
      let currentBookingSelection = null;
      let isAdminMode = false;
      // Realtime Signage Management
let signageWindow = null;
let signageAutoRefresh = true;
let signageRefreshInterval = null;
let isSignageOpen = false;

      // Helper function to count bookings by email
      function countBookingsByEmail(email) {
        const normalizedEmail = email.toLowerCase().trim();
        return Object.values(localData.bookings).filter(
          booking => booking.email.toLowerCase().trim() === normalizedEmail
        ).length;
      }

      // Helper function to get bookings by email
      function getBookingsByEmail(email) {
        const normalizedEmail = email.toLowerCase().trim();
        return Object.values(localData.bookings).filter(
          booking => booking.email.toLowerCase().trim() === normalizedEmail
        );
      }

      // Check email booking limit and display status
      function checkEmailBookingLimit() {
        const email = document.getElementById("userEmail").value.trim();
        const statusElement = document.getElementById("emailBookingStatus");
        
        if (!email) {
          statusElement.style.display = "none";
          return;
        }

        // Email validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          statusElement.textContent = "Voer een geldig e-mailadres in";
          statusElement.className = "status-message error";
          statusElement.style.display = "block";
          return;
        }

        const currentBookingCount = countBookingsByEmail(email);
        const remainingBookings = MAX_BOOKINGS_PER_EMAIL - currentBookingCount;

        if (remainingBookings <= 0) {
          const existingBookings = getBookingsByEmail(email);
          const bookingDetails = existingBookings.map(booking => 
            `${booking.tableName} (${booking.timeSlot})`
          ).join(', ');
          
          statusElement.textContent = `Maximum boekingen bereikt (${MAX_BOOKINGS_PER_EMAIL}/${MAX_BOOKINGS_PER_EMAIL}). Huidige: ${bookingDetails}`;
          statusElement.className = "status-message error";
          statusElement.style.display = "block";
          
          // Disable the confirm button
          const confirmBtn = document.getElementById('confirmBookingBtn');
          if (confirmBtn) {
            confirmBtn.disabled = true;
            confirmBtn.textContent = 'Maximum Boekingen Bereikt';
          }
        } else if (currentBookingCount > 0) {
          const existingBookings = getBookingsByEmail(email);
          const bookingDetails = existingBookings.map(booking => 
            `${booking.tableName} (${booking.timeSlot})`
          ).join(', ');
          
          statusElement.textContent = `${currentBookingCount}/${MAX_BOOKINGS_PER_EMAIL} boekingen gebruikt. ${remainingBookings} resterend. Huidige: ${bookingDetails}`;
          statusElement.className = "status-message warning";
          statusElement.style.display = "block";
          
          // Enable the confirm button
          const confirmBtn = document.getElementById('confirmBookingBtn');
          if (confirmBtn) {
            confirmBtn.disabled = false;
            confirmBtn.textContent = 'Boeking Bevestigen';
          }
        } else {
          statusElement.textContent = `${remainingBookings}/${MAX_BOOKINGS_PER_EMAIL} boekingen beschikbaar`;
          statusElement.className = "status-message success";
          statusElement.style.display = "block";
          
          // Enable the confirm button
          const confirmBtn = document.getElementById('confirmBookingBtn');
          if (confirmBtn) {
            confirmBtn.disabled = false;
            confirmBtn.textContent = 'Boeking Bevestigen';
          }
        }
      }

      // Initialize Firebase
      async function initializeFirebase(config = null) {
        try {
          updateConnectionStatus('connecting');
          
          const firebaseConfig = config || getStoredFirebaseConfig() || DEFAULT_FIREBASE_CONFIG;
          
          if (!firebaseConfig) {
            throw new Error('Geen Firebase configuratie verstrekt');
          }
          
          // Initialize Firebase
          if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
          }
          
          db = firebase.firestore();
          auth = firebase.auth();
          
          // Set up auth state listener
          auth.onAuthStateChanged((user) => {
            currentUser = user;
            if (user && isAdminMode) {
              document.getElementById('adminUserEmail').textContent = user.email;
            }
          });
          
          // Test connection
          await testFirebaseConnection();
          
          isFirebaseInitialized = true;
          isOnline = true;
          updateConnectionStatus('connected');
          
// Set up real-time listeners
setupRealtimeListeners();

// Set up signage real-time listeners
setupSignageRealtimeListeners();
          
          // Load initial data
          await loadDataFromFirestore();
          
        } catch (error) {
          console.error('Firebase initialisatie mislukt:', error);
          isFirebaseInitialized = false;
          isOnline = false;
          updateConnectionStatus('disconnected');
          
          // Use local storage fallback
          loadDataFromLocalStorage();
        }
      }

      function getStoredFirebaseConfig() {
        const stored = localStorage.getItem('firebaseConfig');
        return stored ? JSON.parse(stored) : null;
      }

      function storeFirebaseConfig(config) {
        localStorage.setItem('firebaseConfig', JSON.stringify(config));
      }

      async function testFirebaseConnection() {
        if (!db) throw new Error('Firestore niet ge√Ønitialiseerd');
        
        // Try to read a document to test connectivity
        await db.collection('system').doc('test').get();
      }

      function updateConnectionStatus(status) {
        const statusElement = document.getElementById('connectionStatus');
        const indicator = statusElement.querySelector('.sync-indicator');
        
        switch (status) {
          case 'connected':
            statusElement.className = 'connection-status connected';
            statusElement.innerHTML = '<span class="sync-indicator synced"></span>‚óè';
            break;
          case 'connecting':
            statusElement.className = 'connection-status disconnected';
            statusElement.innerHTML = '<span class="sync-indicator syncing"></span>‚óè';
            break;
          case 'disconnected':
            statusElement.className = 'connection-status disconnected';
            statusElement.innerHTML = '<span class="sync-indicator"></span>‚óã';
            break;
          case 'syncing':
            if (statusElement.className.includes('connected')) {
              indicator.className = 'sync-indicator syncing';
            }
            break;
          case 'synced':
            if (statusElement.className.includes('connected')) {
              indicator.className = 'sync-indicator synced';
            }
            break;
        }
      }

      function setupRealtimeListeners() {
        if (!db) return;

        // Listen to event configuration changes
        const eventConfigRef = db.collection('system').doc('eventConfig');
        const unsubscribeEventConfig = eventConfigRef.onSnapshot((doc) => {
          if (doc.exists) {
            localData.eventConfig = doc.data();
            updateEventUI();
            renderClientInterface();
          }
        }, (error) => {
          console.error('Fout bij beluisteren van event config:', error);
        });

        // Listen to tables changes
        const tablesRef = db.collection('tables');
        const unsubscribeTables = tablesRef.onSnapshot((snapshot) => {
          snapshot.docChanges().forEach((change) => {
            const tableData = { id: change.doc.id, ...change.doc.data() };
            
            if (change.type === 'added') {
              const existingIndex = localData.tables.findIndex(t => t.id === tableData.id);
              if (existingIndex === -1) {
                localData.tables.push(tableData);
              }
            } else if (change.type === 'removed') {
              localData.tables = localData.tables.filter(t => t.id !== tableData.id);
            } else if (change.type === 'modified') {
              const index = localData.tables.findIndex(t => t.id === tableData.id);
              if (index !== -1) {
                localData.tables[index] = tableData;
              }
            }
          });
          
          localData.tables.sort((a, b) => (a.order || 0) - (b.order || 0));
          renderTables();
          renderClientInterface();
        }, (error) => {
          console.error('Fout bij beluisteren van tafels:', error);
        });

        // Listen to bookings changes
        const bookingsRef = db.collection('bookings');
        const unsubscribeBookings = bookingsRef.onSnapshot((snapshot) => {
          localData.bookings = {};
          snapshot.forEach((doc) => {
            localData.bookings[doc.id] = doc.data();
          });
          renderBookingsOverview();
          renderClientInterface();
        }, (error) => {
          console.error('Fout bij beluisteren van boekingen:', error);
        });

        unsubscribeListeners = [unsubscribeEventConfig, unsubscribeTables, unsubscribeBookings];
      }

      // Authentication functions
      function showLoginModal() {
        document.getElementById("overlay").style.display = "block";
        document.getElementById("loginModal").style.display = "block";
        document.getElementById("adminEmail").value = "";
        document.getElementById("adminPassword").value = "";
        document.getElementById("loginError").style.display = "none";
        document.getElementById("adminEmail").focus();
      }

      function closeLoginModal() {
        document.getElementById("overlay").style.display = "none";
        document.getElementById("loginModal").style.display = "none";
      }

      async function loginAdmin() {
        // Prevent form submission
        event?.preventDefault();
        const rememberMe = document.getElementById("rememberMe").checked;

// ‚úÖ NIEUWE: Sla login session op
saveLoginSession(email, rememberMe);

if (rememberMe) {
  showUserManagementStatus("Succesvol ingelogd. U blijft 30 dagen ingelogd op dit apparaat.", "success");
}
        const email = document.getElementById("adminEmail").value.trim();
        const password = document.getElementById("adminPassword").value;

        if (!email || !password) {
          showLoginError("Voer e-mail en wachtwoord in");
          return false;
        }

        if (!auth) {
          showLoginError("Authenticatie niet beschikbaar - controleer Firebase configuratie");
          return false;
        }

        try {
          const userCredential = await auth.signInWithEmailAndPassword(email, password);
          currentUser = userCredential.user;
          isAdminMode = true;
          closeLoginModal();
          switchToAdmin();
        } catch (error) {
          console.error('Inloggen mislukt:', error);
          let errorMessage = "Inloggen mislukt";
          switch (error.code) {
            case 'auth/user-not-found':
              errorMessage = "Geen admin account gevonden met dit e-mailadres";
              break;
            case 'auth/wrong-password':
              errorMessage = "Onjuist wachtwoord";
              break;
            case 'auth/invalid-email':
              errorMessage = "Ongeldig e-mailadres";
              break;
            case 'auth/too-many-requests':
              errorMessage = "Te veel mislukte pogingen. Probeer later opnieuw";
              break;
            default:
              errorMessage = error.message;
          }
          showLoginError(errorMessage);
        }
        return false;
      }

      function showLoginError(message) {
        const element = document.getElementById("loginError");
        element.textContent = message;
        element.style.display = "block";
      }

      async function logout() {
        if (auth && currentUser) {
          try {
            await auth.signOut();
            currentUser = null;
            isAdminMode = false;
            switchToClient();
          } catch (error) {
            console.error('Uitloggen mislukt:', error);
          }
        } else {
          // Fallback for when auth is not available
          currentUser = null;
          isAdminMode = false;
          switchToClient();
        }
      }

      async function createAdminUser() {
        const email = document.getElementById("newUserEmail").value.trim();
        const password = document.getElementById("newUserPassword").value;

        if (!email || !password) {
          showUserManagementStatus("Voer e-mail en wachtwoord in", "error");
          return;
        }

        if (password.length < 6) {
          showUserManagementStatus("Wachtwoord moet minimaal 6 tekens bevatten", "error");
          return;
        }

        if (!auth) {
          showUserManagementStatus("Authenticatie niet beschikbaar - controleer Firebase configuratie", "error");
          return;
        }

        try {
          // Create user account
          const userCredential = await auth.createUserWithEmailAndPassword(email, password);
          
          // Send email verification
          await userCredential.user.sendEmailVerification();
          
          showUserManagementStatus("Admin gebruiker succesvol aangemaakt. Verificatie e-mail verzonden.", "success");
          
          // Clear form
          document.getElementById("newUserEmail").value = "";
          document.getElementById("newUserPassword").value = "";
          
        } catch (error) {
          console.error('Gebruiker aanmaken mislukt:', error);
          let errorMessage = "Gebruiker aanmaken mislukt";
          switch (error.code) {
            case 'auth/email-already-in-use':
              errorMessage = "Een account met dit e-mailadres bestaat al";
              break;
            case 'auth/invalid-email':
              errorMessage = "Ongeldig e-mailadres";
              break;
            case 'auth/weak-password':
              errorMessage = "Wachtwoord is te zwak";
              break;
            default:
              errorMessage = error.message;
          }
          showUserManagementStatus(errorMessage, "error");
        }
      }

      function changePassword() {
        document.getElementById("overlay").style.display = "block";
        document.getElementById("passwordChangeModal").style.display = "block";
        document.getElementById("currentPassword").value = "";
        document.getElementById("newPassword").value = "";
        document.getElementById("confirmPassword").value = "";
        document.getElementById("passwordChangeStatus").style.display = "none";
      }

      function closePasswordChangeModal() {
        document.getElementById("overlay").style.display = "none";
        document.getElementById("passwordChangeModal").style.display = "none";
      }

      async function updatePassword() {
        // Prevent form submission
        event?.preventDefault();
        
        const currentPassword = document.getElementById("currentPassword").value;
        const newPassword = document.getElementById("newPassword").value;
        const confirmPassword = document.getElementById("confirmPassword").value;

        if (!currentPassword || !newPassword || !confirmPassword) {
          showPasswordChangeStatus("Vul alle velden in", "error");
          return false;
        }

        if (newPassword !== confirmPassword) {
          showPasswordChangeStatus("Nieuwe wachtwoorden komen niet overeen", "error");
          return false;
        }

        if (newPassword.length < 6) {
          showPasswordChangeStatus("Wachtwoord moet minimaal 6 tekens bevatten", "error");
          return false;
        }

        if (!auth || !currentUser) {
          showPasswordChangeStatus("Niet geauthenticeerd", "error");
          return false;
        }

        try {
          // Reauthenticate user with current password
          const credential = firebase.auth.EmailAuthProvider.credential(
            currentUser.email,
            currentPassword
          );
          await currentUser.reauthenticateWithCredential(credential);
          
          // Update password
          await currentUser.updatePassword(newPassword);
          
          showPasswordChangeStatus("Wachtwoord succesvol bijgewerkt", "success");
          
          // Clear form
          document.getElementById("currentPassword").value = "";
          document.getElementById("newPassword").value = "";
          document.getElementById("confirmPassword").value = "";
          
          // Close modal after 2 seconds
          setTimeout(() => {
            closePasswordChangeModal();
          }, 2000);
          
        } catch (error) {
          console.error('Wachtwoord wijzigen mislukt:', error);
          let errorMessage = "Wachtwoord wijzigen mislukt";
          switch (error.code) {
            case 'auth/wrong-password':
              errorMessage = "Huidig wachtwoord is onjuist";
              break;
            case 'auth/weak-password':
              errorMessage = "Nieuw wachtwoord is te zwak";
              break;
            default:
              errorMessage = error.message;
          }
          showPasswordChangeStatus(errorMessage, "error");
        }
        return false;
      }

      function showUserManagementStatus(message, type) {
        const element = document.getElementById("userManagementStatus");
        element.textContent = message;
        element.className = `status-message ${type}`;
        element.style.display = "block";

        setTimeout(() => {
          element.style.display = "none";
        }, 5000);
      }

      function showPasswordChangeStatus(message, type) {
        const element = document.getElementById("passwordChangeStatus");
        element.textContent = message;
        element.className = `status-message ${type}`;
        element.style.display = "block";

        setTimeout(() => {
          element.style.display = "none";
        }, 5000);
      }
      // Remember Me Functionality
function saveLoginSession(email, rememberMe) {
  const loginData = {
    email: email,
    timestamp: Date.now(),
    rememberMe: rememberMe
  };
  
  if (rememberMe) {
    // Sla op voor 30 dagen
    localStorage.setItem('adminLoginSession', JSON.stringify(loginData));
  } else {
    // Alleen voor huidige sessie
    sessionStorage.setItem('adminLoginSession', JSON.stringify(loginData));
  }
}

function getStoredLoginSession() {
  // Probeer localStorage eerst (remember me)
  let stored = localStorage.getItem('adminLoginSession');
  if (stored) {
    const loginData = JSON.parse(stored);
    const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
    
    if (loginData.timestamp > thirtyDaysAgo && loginData.rememberMe) {
      return loginData;
    } else {
      // Verlopen - verwijder
      localStorage.removeItem('adminLoginSession');
    }
  }
  
  // Probeer sessionStorage (huidige sessie)
  stored = sessionStorage.getItem('adminLoginSession');
  if (stored) {
    return JSON.parse(stored);
  }
  
  return null;
}

function clearAllLoginSessions() {
  localStorage.removeItem('adminLoginSession');
  sessionStorage.removeItem('adminLoginSession');
  localStorage.setItem('forceLogout', Date.now().toString());
}

async function logoutEverywhere() {
  if (confirm("Weet u zeker dat u op alle apparaten wilt uitloggen?")) {
    try {
      if (auth && currentUser) {
        await auth.signOut();
      }
      
      currentUser = null;
      isAdminMode = false;
      clearAllLoginSessions();
      switchToClient();
      alert("U bent uitgelogd op alle apparaten.");
      
    } catch (error) {
      console.error('Uitloggen mislukt:', error);
    }
  }
}

      // Firestore data operations
      async function saveEventConfigToFirestore() {
        if (!db) {
          saveDataToLocalStorage();
          return;
        }

        try {
          updateConnectionStatus('syncing');
          await db.collection('system').doc('eventConfig').set(localData.eventConfig);
          updateConnectionStatus('synced');
        } catch (error) {
          console.error('Fout bij opslaan van event config:', error);
          saveDataToLocalStorage();
        }
      }

      async function saveTableToFirestore(table) {
        if (!db) {
          saveDataToLocalStorage();
          return table.id;
        }

        try {
          updateConnectionStatus('syncing');
          const docRef = await db.collection('tables').add({
            ...table,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
          updateConnectionStatus('synced');
          return docRef.id;
        } catch (error) {
          console.error('Fout bij opslaan van tafel:', error);
          saveDataToLocalStorage();
          return table.id;
        }
      }

      async function removeTableFromFirestore(tableId) {
        if (!db) {
          saveDataToLocalStorage();
          return;
        }

        try {
          updateConnectionStatus('syncing');
          await db.collection('tables').doc(tableId).delete();
          
          // Remove related bookings
          const bookingsSnapshot = await db.collection('bookings')
            .where('tableId', '==', tableId)
            .get();
          
          const batch = db.batch();
          bookingsSnapshot.forEach((doc) => {
            batch.delete(doc.ref);
          });
          await batch.commit();
          
          updateConnectionStatus('synced');
        } catch (error) {
          console.error('Fout bij verwijderen van tafel:', error);
          saveDataToLocalStorage();
        }
      }

      async function saveBookingToFirestore(bookingKey, booking) {
        if (!db) {
          saveDataToLocalStorage();
          return;
        }

        try {
          updateConnectionStatus('syncing');
          await db.collection('bookings').doc(bookingKey).set({
            ...booking,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
          updateConnectionStatus('synced');
        } catch (error) {
          console.error('Fout bij opslaan van boeking:', error);
          saveDataToLocalStorage();
          throw error;
        }
      }

      async function removeBookingFromFirestore(bookingKey) {
        if (!db) {
          saveDataToLocalStorage();
          return;
        }

        try {
          updateConnectionStatus('syncing');
          await db.collection('bookings').doc(bookingKey).delete();
          updateConnectionStatus('synced');
        } catch (error) {
          console.error('Fout bij verwijderen van boeking:', error);
          saveDataToLocalStorage();
        }
      }

      async function loadDataFromFirestore() {
        if (!db) return;

        try {
          // Load event configuration
          const eventConfigDoc = await db.collection('system').doc('eventConfig').get();
          if (eventConfigDoc.exists) {
            localData.eventConfig = eventConfigDoc.data();
          }

          // Load tables
          const tablesSnapshot = await db.collection('tables').get();
          localData.tables = [];
          tablesSnapshot.forEach((doc) => {
            const tableData = { id: doc.id, ...doc.data() };
            if (typeof tableData.order === 'undefined') {
              tableData.order = localData.tables.length;
            }
            localData.tables.push(tableData);
          });
          localData.tables.sort((a, b) => (a.order || 0) - (b.order || 0));

          // Load bookings
          const bookingsSnapshot = await db.collection('bookings').get();
          localData.bookings = {};
          bookingsSnapshot.forEach((doc) => {
            localData.bookings[doc.id] = doc.data();
          });

          updateUI();
        } catch (error) {
          console.error('Fout bij laden van data van Firestore:', error);
          loadDataFromLocalStorage();
        }
      }

      // Local storage fallback
      function saveDataToLocalStorage() {
        localStorage.setItem('bookingSystemData', JSON.stringify(localData));
      }

      function loadDataFromLocalStorage() {
        const stored = localStorage.getItem('bookingSystemData');
        if (stored) {
          localData = { ...localData, ...JSON.parse(stored) };
        }
        updateUI();
      }

      function updateUI() {
        updateEventUI();
        renderTables();
        renderBookingsOverview();
        renderClientInterface();
      }

      function updateEventUI() {
        if (localData.eventConfig.date) {
          document.getElementById('eventDate').value = localData.eventConfig.date;
        }
        document.getElementById('startTime').value = localData.eventConfig.startTime;
        document.getElementById('endTime').value = localData.eventConfig.endTime;
        document.getElementById('slotDuration').value = localData.eventConfig.slotDuration;
      }

      // Firebase configuration management
      function updateFirebaseConfig() {
        const config = {
          apiKey: document.getElementById('firebaseApiKey').value.trim(),
          authDomain: document.getElementById('firebaseAuthDomain').value.trim(),
          projectId: document.getElementById('firebaseProjectId').value.trim(),
          storageBucket: document.getElementById('firebaseStorageBucket').value.trim(),
          messagingSenderId: document.getElementById('firebaseMessagingSenderId').value.trim(),
          appId: document.getElementById('firebaseAppId').value.trim()
        };

        if (!config.projectId || !config.apiKey) {
          showFirebaseConfigStatus('Project ID en API Sleutel zijn vereist', 'error');
          return;
        }

        storeFirebaseConfig(config);
        showFirebaseConfigStatus('Configuratie opgeslagen. Opnieuw verbinden...', 'success');

        unsubscribeListeners.forEach(unsubscribe => unsubscribe());
        unsubscribeListeners = [];

        setTimeout(() => {
          initializeFirebase(config);
        }, 1000);
      }

      function resetToDemo() {
        localStorage.removeItem('firebaseConfig');
        showFirebaseConfigStatus('Configuratie gereset naar standaard.', 'success');
        
        if (DEFAULT_FIREBASE_CONFIG) {
          document.getElementById('firebaseApiKey').value = DEFAULT_FIREBASE_CONFIG.apiKey || '';
          document.getElementById('firebaseAuthDomain').value = DEFAULT_FIREBASE_CONFIG.authDomain || '';
          document.getElementById('firebaseProjectId').value = DEFAULT_FIREBASE_CONFIG.projectId || '';
          document.getElementById('firebaseStorageBucket').value = DEFAULT_FIREBASE_CONFIG.storageBucket || '';
          document.getElementById('firebaseMessagingSenderId').value = DEFAULT_FIREBASE_CONFIG.messagingSenderId || '';
          document.getElementById('firebaseAppId').value = DEFAULT_FIREBASE_CONFIG.appId || '';
          
          unsubscribeListeners.forEach(unsubscribe => unsubscribe());
          unsubscribeListeners = [];
          
          setTimeout(() => {
            initializeFirebase(DEFAULT_FIREBASE_CONFIG);
          }, 1000);
        } else {
          document.getElementById('firebaseApiKey').value = '';
          document.getElementById('firebaseAuthDomain').value = '';
          document.getElementById('firebaseProjectId').value = '';
          document.getElementById('firebaseStorageBucket').value = '';
          document.getElementById('firebaseMessagingSenderId').value = '';
          document.getElementById('firebaseAppId').value = '';

          unsubscribeListeners.forEach(unsubscribe => unsubscribe());
          unsubscribeListeners = [];
          
          isFirebaseInitialized = false;
          isOnline = false;
          db = null;
          auth = null;
          updateConnectionStatus('disconnected');
          
          loadDataFromLocalStorage();
        }
      }

      function testFirebaseConnection() {
        showFirebaseConfigStatus('Verbinding testen...', 'success');
        
        setTimeout(async () => {
          try {
            await testFirebaseConnection();
            showFirebaseConfigStatus('Verbinding succesvol getest', 'success');
          } catch (error) {
            showFirebaseConfigStatus('Verbindingstest mislukt: ' + error.message, 'error');
          }
        }, 1000);
      }

      function showFirebaseConfigStatus(message, type) {
        const element = document.getElementById('firebaseConfigStatus');
        element.textContent = message;
        element.className = `status-message ${type}`;
        element.style.display = 'block';

        setTimeout(() => {
          element.style.display = 'none';
        }, 5000);
      }

      // EmailJS configuration management
      function getStoredEmailConfig() {
        const stored = localStorage.getItem('emailConfig');
        return stored ? JSON.parse(stored) : null;
      }

      function storeEmailConfig(config) {
        localStorage.setItem('emailConfig', JSON.stringify(config));
      }

      function updateEmailConfig() {
        const config = {
          serviceId: document.getElementById('emailServiceId').value.trim(),
          templateId: document.getElementById('emailTemplateId').value.trim(),
          publicKey: document.getElementById('emailPublicKey').value.trim(),
          fromName: document.getElementById('emailFromName').value.trim() || 'Event Team'
        };

        // Validate required fields
        if (!config.serviceId || !config.templateId || !config.publicKey) {
          showEmailConfigStatus('Alle EmailJS velden zijn vereist', 'error');
          return;
        }

        // Update global config
        EMAILJS_CONFIG = config;
        storeEmailConfig(config);
        
        // Reinitialize EmailJS
        if (typeof emailjs !== 'undefined') {
          emailjs.init(config.publicKey);
        }
        
        showEmailConfigStatus('E-mail configuratie succesvol opgeslagen', 'success');
      }

      async function testEmailConfig() {
        if (!EMAILJS_CONFIG.serviceId || !EMAILJS_CONFIG.templateId || !EMAILJS_CONFIG.publicKey) {
          showEmailConfigStatus('Configureer eerst EmailJS instellingen', 'error');
          return;
        }

        if (typeof emailjs === 'undefined') {
          showEmailConfigStatus('EmailJS niet geladen', 'error');
          return;
        }

        const testEmail = currentUser ? currentUser.email : 'test@example.com';
        
        const testParams = {
          user_name: 'Test Gebruiker',
          user_email: testEmail,
          artist_name: 'Test Artiest',
          table_name: 'Test Tafel',
          speakers: 'Spreker 1 & Spreker 2',
          event_date: 'Test Datum',
          time_slot: '10:00 - 10:10',
          to_email: testEmail,
        };

        try {
          showEmailConfigStatus('Test e-mail verzenden...', 'success');
          
          await emailjs.send(
            EMAILJS_CONFIG.serviceId,
            EMAILJS_CONFIG.templateId,
            testParams,
            EMAILJS_CONFIG.publicKey
          );
          
          showEmailConfigStatus(`Test e-mail succesvol verzonden naar ${testEmail}`, 'success');
        } catch (error) {
          console.error('Test e-mail mislukt:', error);
          showEmailConfigStatus('Test e-mail mislukt: ' + error.text || error.message, 'error');
        }
      }

      function loadEmailConfig() {
        const stored = getStoredEmailConfig();
        if (stored) {
          EMAILJS_CONFIG = { ...EMAILJS_CONFIG, ...stored };
          
          // Load into form fields
          document.getElementById('emailServiceId').value = stored.serviceId || '';
          document.getElementById('emailTemplateId').value = stored.templateId || '';
          document.getElementById('emailPublicKey').value = stored.publicKey || '';
          document.getElementById('emailFromName').value = stored.fromName || '';
          
          // Initialize EmailJS with stored config
          if (typeof emailjs !== 'undefined' && stored.publicKey) {
            emailjs.init(stored.publicKey);
          }
        }
      }

      function showEmailConfigStatus(message, type) {
        const element = document.getElementById('emailConfigStatus');
        element.textContent = message;
        element.className = `status-message ${type}`;
        element.style.display = 'block';

        setTimeout(() => {
          element.style.display = 'none';
        }, 5000);
      }

      function switchToAdmin() {
        document.getElementById("client-interface").style.display = "none";
        document.getElementById("admin-interface").style.display = "block";
        
        if (currentUser) {
          document.getElementById('adminUserEmail').textContent = currentUser.email;
        }
        
        // Load Firebase config
        const config = getStoredFirebaseConfig() || DEFAULT_FIREBASE_CONFIG;
        if (config) {
          document.getElementById('firebaseApiKey').value = config.apiKey || '';
          document.getElementById('firebaseAuthDomain').value = config.authDomain || '';
          document.getElementById('firebaseProjectId').value = config.projectId || '';
          document.getElementById('firebaseStorageBucket').value = config.storageBucket || '';
          document.getElementById('firebaseMessagingSenderId').value = config.messagingSenderId || '';
          document.getElementById('firebaseAppId').value = config.appId || '';
        }
        
        // Load Email config
        loadEmailConfig();
        
        renderBookingsOverview();
      }

      function switchToClient() {
        isAdminMode = false;
        document.getElementById("client-interface").style.display = "block";
        document.getElementById("admin-interface").style.display = "none";
        renderClientInterface();
      }

      function switchTab(tabName) {
        document.querySelectorAll(".nav-tab").forEach((tab) => tab.classList.remove("active"));
        document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add("active");

        document.querySelectorAll(".tab-content").forEach((content) => content.classList.remove("active"));
        document.getElementById(`${tabName}-tab`).classList.add("active");

        if (tabName === "bookings") {
          renderBookingsOverview();
        }
      }

      async function generateTimeSlots() {
        const date = document.getElementById("eventDate").value;
        const startTime = document.getElementById("startTime").value;
        const endTime = document.getElementById("endTime").value;
        const duration = parseInt(document.getElementById("slotDuration").value);

        if (!date || !startTime || !endTime) {
          showStatus("eventStatus", "Vul alle velden in", "error");
          return;
        }

        if (startTime >= endTime) {
          showStatus("eventStatus", "Eindtijd moet na starttijd zijn", "error");
          return;
        }

        localData.eventConfig.date = date;
        localData.eventConfig.startTime = startTime;
        localData.eventConfig.endTime = endTime;
        localData.eventConfig.slotDuration = duration;

        const slots = [];
        const start = new Date(`${date}T${startTime}`);
        const end = new Date(`${date}T${endTime}`);

        let current = new Date(start);
        let slotIndex = 0;

        while (current < end) {
          const slotEnd = new Date(current.getTime() + duration * 60000);
          if (slotEnd <= end) {
            slots.push({
              index: slotIndex++,
              start: current.toTimeString().slice(0, 5),
              end: slotEnd.toTimeString().slice(0, 5),
              startTime: current.toISOString(),
              endTime: slotEnd.toISOString(),
            });
          }
          current = new Date(slotEnd);
        }

        localData.eventConfig.timeSlots = slots;
        await saveEventConfigToFirestore();
        
        showStatus("eventStatus", `${slots.length} tijdslots gegenereerd van ${startTime} tot ${endTime}`, "success");
      }

      async function addTable() {
        const name = document.getElementById("tableName").value.trim();
        const speaker1 = document.getElementById("speaker1").value.trim();
        const speaker2 = document.getElementById("speaker2").value.trim();

        if (!name || !speaker1 || !speaker2) {
          alert("Vul alle tafel velden in");
          return;
        }

        if (localData.tables.length >= 20) {
          alert("Maximaal 20 tafels toegestaan");
          return;
        }

        const table = {
          name: name,
          speaker1: speaker1,
          speaker2: speaker2,
          order: localData.tables.length
        };

        try {
          if (db) {
            const tableId = await saveTableToFirestore(table);
            table.id = tableId;
            // Don't add to localData.tables here - the realtime listener will handle it
          } else {
            table.id = `table_${Date.now()}`;
            localData.tables.push(table);
            renderTables();
            saveDataToLocalStorage();
          }

          document.getElementById("tableName").value = "";
          document.getElementById("speaker1").value = "";
          document.getElementById("speaker2").value = "";
          
        } catch (error) {
          console.error('Tafel toevoegen mislukt:', error);
          alert('Tafel toevoegen mislukt. Probeer opnieuw.');
        }
      }

      function renderTables() {
        const grid = document.getElementById("tablesGrid");
        
        if (localData.tables.length === 0) {
          grid.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Nog geen tafels geconfigureerd.</p>';
          return;
        }
        
        grid.innerHTML = localData.tables.map((table, index) => `
          <div class="table-card">
            <h4>Tafel ${index + 1}: ${table.name}</h4>
            <p><strong>Sprekers:</strong> ${table.speaker1} & ${table.speaker2}</p>
            <button onclick="removeTable('${table.id}')" class="btn-danger" style="margin-top: 10px;">Verwijderen</button>
          </div>
        `).join("");
      }

      async function removeTable(tableId) {
        if (confirm("Weet u zeker dat u deze tafel en alle boekingen wilt verwijderen?")) {
          try {
            const tableIndex = localData.tables.findIndex(t => t.id === tableId);
            if (tableIndex !== -1) {
              localData.tables.splice(tableIndex, 1);
              renderTables();
            }
            
            Object.keys(localData.bookings).forEach((key) => {
              if (localData.bookings[key].tableId === tableId) {
                delete localData.bookings[key];
              }
            });
            
            if (db) {
              await removeTableFromFirestore(tableId);
            } else {
              saveDataToLocalStorage();
            }
            
          } catch (error) {
            console.error('Tafel verwijderen mislukt:', error);
            if (db) {
              await loadDataFromFirestore();
            } else {
              loadDataFromLocalStorage();
            }
            alert('Tafel verwijderen mislukt. Probeer opnieuw.');
          }
        }
      }

      function renderClientInterface() {
        const eventInfo = document.getElementById("eventInfo");
        if (localData.eventConfig.date && localData.eventConfig.timeSlots.length > 0) {
          const eventDate = new Date(localData.eventConfig.date).toLocaleDateString("nl-NL", {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
          });
          eventInfo.innerHTML = `
            <strong>${eventDate}</strong><br>
            ${localData.eventConfig.startTime} - ${localData.eventConfig.endTime} | ${localData.eventConfig.slotDuration} minuten per sessie<br>
            <small style="color: #856404; font-weight: 500;">üìù Maximaal ${MAX_BOOKINGS_PER_EMAIL} boekingen per artiest/band</small>
          `;
        } else {
          eventInfo.innerHTML = "Evenement nog niet geconfigureerd";
        }

        const container = document.getElementById("clientBookingGrid");

        if (localData.tables.length === 0 || localData.eventConfig.timeSlots.length === 0) {
          container.innerHTML = "<p>Geen tafels beschikbaar voor boeking op dit moment.</p>";
          return;
        }

        container.innerHTML = localData.tables.map((table, tableIndex) => `
          <div class="client-table-card">
            <div class="table-header">
              <div class="table-title">${table.name}</div>
              <div class="speakers">met ${table.speaker1} & ${table.speaker2}</div>
            </div>
            <div class="time-slots-container">
              ${localData.eventConfig.timeSlots.map((slot) => {
                const bookingKey = `${table.id}-${slot.index}`;
                const isBooked = localData.bookings[bookingKey];
                return `
                  <div class="time-slot-item ${isBooked ? "booked" : "available"}">
                    <div class="time-info">${slot.start} - ${slot.end}</div>
                    <button class="slot-btn ${isBooked ? "booked" : "available"}" 
                            ${!isBooked ? `onclick="openBookingForm('${table.id}', ${slot.index})"` : ""}
                            ${isBooked ? "disabled" : ""}>
                      ${isBooked ? "Geboekt" : "Boeken"}
                    </button>
                  </div>
                `;
              }).join("")}
            </div>
          </div>
        `).join("");
      }

      function openBookingForm(tableId, slotIndex) {
        const table = localData.tables.find((t) => t.id === tableId);
        const slot = localData.eventConfig.timeSlots.find((s) => s.index === slotIndex);

        if (!table || !slot) {
          alert("Fout: Tafel of tijdslot niet gevonden");
          return;
        }

        currentBookingSelection = { tableId, slotIndex };

        const eventDate = new Date(localData.eventConfig.date).toLocaleDateString("nl-NL", {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        });

        document.getElementById("selectedSlotInfo").innerHTML = `
          <strong>${table.name}</strong><br>
          ${eventDate}<br>
          ${slot.start} - ${slot.end}<br>
          Sprekers: ${table.speaker1} & ${table.speaker2}
        `;

        document.getElementById("overlay").style.display = "block";
        document.getElementById("bookingForm").style.display = "block";
        document.getElementById("userName").value = "";
        document.getElementById("userEmail").value = "";
        document.getElementById("userArtistName").value = "";
        document.getElementById("bookingStatus").style.display = "none";
        document.getElementById("emailBookingStatus").style.display = "none";
        
        // Reset confirm button
        const confirmBtn = document.getElementById('confirmBookingBtn');
        confirmBtn.disabled = false;
        confirmBtn.textContent = 'Boeking Bevestigen';
      }

      function closeBookingForm() {
        document.getElementById("overlay").style.display = "none";
        document.getElementById("bookingForm").style.display = "none";
        currentBookingSelection = null;
      }

      async function confirmBooking() {
        // Prevent form submission
        event?.preventDefault();
        
        const name = document.getElementById("userName").value.trim();
        const email = document.getElementById("userEmail").value.trim();
        const artistName = document.getElementById("userArtistName").value.trim();

        if (!name || !email || !artistName) {
          showStatus("bookingStatus", "Vul alle verplichte velden in", "error");
          return false;
        }

        // Email validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          showStatus("bookingStatus", "Voer een geldig e-mailadres in", "error");
          return false;
        }

        // Check booking limit per email
        const currentBookingCount = countBookingsByEmail(email);
        if (currentBookingCount >= MAX_BOOKINGS_PER_EMAIL) {
          const existingBookings = getBookingsByEmail(email);
          const bookingDetails = existingBookings.map(booking => 
            `${booking.tableName} (${booking.timeSlot} op ${new Date(booking.date).toLocaleDateString()})`
          ).join(', ');
          
          showStatus("bookingStatus", 
            `Dit e-mailadres heeft al het maximum van ${MAX_BOOKINGS_PER_EMAIL} boekingen bereikt. Huidige boekingen: ${bookingDetails}`, 
            "error"
          );
          return false;
        }

        if (!currentBookingSelection) {
          showStatus("bookingStatus", "Geen tijdslot geselecteerd", "error");
          return false;
        }

        const { tableId, slotIndex } = currentBookingSelection;
        const bookingKey = `${tableId}-${slotIndex}`;

        if (localData.bookings[bookingKey]) {
          showStatus("bookingStatus", "Dit tijdslot is al geboekt", "error");
          return false;
        }

        const table = localData.tables.find((t) => t.id === tableId);
        const slot = localData.eventConfig.timeSlots.find((s) => s.index === slotIndex);

        const booking = {
          name: name,
          email: email,
          artistName: artistName,
          tableId: tableId,
          slotIndex: slotIndex,
          tableName: table.name,
          speaker1: table.speaker1,
          speaker2: table.speaker2,
          timeSlot: `${slot.start} - ${slot.end}`,
          date: localData.eventConfig.date,
          timestamp: new Date().toISOString(),
        };

        const confirmBtn = document.getElementById('confirmBookingBtn');
        confirmBtn.disabled = true;
        confirmBtn.textContent = 'Verwerken...';

        try {
          showStatus("bookingStatus", "Boeking wordt verwerkt...", "success");

          await saveBookingToFirestore(bookingKey, booking);
          
          localData.bookings[bookingKey] = booking;
          currentBookingConfirmation = booking;

          const eventDate = new Date(booking.date).toLocaleDateString("nl-NL", {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
          });

          const emailParams = {
            user_name: booking.name,
            user_email: booking.email,
            artist_name: booking.artistName,
            table_name: booking.tableName,
            speakers: `${booking.speaker1} & ${booking.speaker2}`,
            event_date: eventDate,
            time_slot: booking.timeSlot,
            to_email: booking.email,
            from_name: EMAILJS_CONFIG.fromName || 'Event Team'
          };

          try {
            if (typeof emailjs !== 'undefined') {
              await emailjs.send(
                EMAILJS_CONFIG.serviceId,
                EMAILJS_CONFIG.templateId,
                emailParams,
                EMAILJS_CONFIG.publicKey
              );
            }
          } catch (emailError) {
            console.log("E-mail verzenden mislukt:", emailError);
          }

          closeBookingForm();
          showConfirmationModal();
          
        } catch (error) {
          console.error('Boeking mislukt:', error);
          showStatus("bookingStatus", "Boeking mislukt. Probeer opnieuw.", "error");
        } finally {
          confirmBtn.disabled = false;
          confirmBtn.textContent = 'Boeking Bevestigen';
        }
        return false;
      }

      function showConfirmationModal() {
        const booking = currentBookingConfirmation;
        const eventDate = new Date(booking.date).toLocaleDateString("nl-NL", {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        });

        document.getElementById("confirmationDetails").innerHTML = `
          <div class="confirmation-details">
            <strong>Boekingsdetails:</strong><br>
            <strong>Naam:</strong> ${booking.name}<br>
            <strong>E-mail:</strong> ${booking.email}<br>
            <strong>Artiest/Band:</strong> ${booking.artistName}<br>
            <strong>Tafel:</strong> ${booking.tableName}<br>
            <strong>Sprekers:</strong> ${booking.speaker1} & ${booking.speaker2}<br>
            <strong>Datum:</strong> ${eventDate}<br>
            <strong>Tijd:</strong> ${booking.timeSlot}
          </div>
        `;

        document.getElementById("overlay").style.display = "block";
        document.getElementById("confirmationModal").style.display = "block";
      }

      function closeConfirmationModal() {
        document.getElementById("overlay").style.display = "none";
        document.getElementById("confirmationModal").style.display = "none";
        document.getElementById("emailPreview").classList.add("hidden");
      }

      function addToCalendar() {
        const booking = currentBookingConfirmation;
        const eventDate = new Date(booking.date);
        const [startHour, startMinute] = booking.timeSlot.split(" - ")[0].split(":");
        const [endHour, endMinute] = booking.timeSlot.split(" - ")[1].split(":");

        const startTime = new Date(eventDate);
        startTime.setHours(parseInt(startHour), parseInt(startMinute));

        const endTime = new Date(eventDate);
        endTime.setHours(parseInt(endHour), parseInt(endMinute));

        const event = {
          title: `Gesprekstafel: ${booking.tableName}`,
          start: startTime,
          end: endTime,
          description: `Gesprek met ${booking.speaker1} & ${booking.speaker2}`,
          location: "Event Locatie",
        };

        const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Your Company//Event//EN
BEGIN:VEVENT
UID:${Date.now()}@yourcompany.com
DTSTAMP:${new Date().toISOString().replace(/[-:]/g, "").split(".")[0]}Z
DTSTART:${startTime.toISOString().replace(/[-:]/g, "").split(".")[0]}Z
DTEND:${endTime.toISOString().replace(/[-:]/g, "").split(".")[0]}Z
SUMMARY:${event.title}
DESCRIPTION:${event.description}
LOCATION:${event.location}
END:VEVENT
END:VCALENDAR`;

        const blob = new Blob([icsContent], { type: "text/calendar" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "gesprekstafel-boeking.ics";
        a.click();
        URL.revokeObjectURL(url);
      }

      function showEmailPreview() {
        const booking = currentBookingConfirmation;
        const eventDate = new Date(booking.date).toLocaleDateString("nl-NL", {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        });

        const emailContent = `
          <h4>E-mail Bevestiging Voorbeeld</h4>
          <div style="border: 1px solid #ddd; padding: 15px; background: white; margin-top: 10px;">
            <strong>Onderwerp:</strong> Gesprekstafel Boeking Bevestigd<br><br>
            <strong>Beste ${booking.name},</strong><br><br>
            
            Uw boeking is bevestigd.<br><br>
            
            <strong>Evenement Details:</strong><br>
            Datum: ${eventDate}<br>
            Tijd: ${booking.timeSlot}<br>
            Tafel: ${booking.tableName}<br>
            Sprekers: ${booking.speaker1} & ${booking.speaker2}<br><br>
            
            Kom alstublieft 5 minuten voor uw geplande tijd aan.<br><br>
            
            Met vriendelijke groet,<br>
            Event Team
          </div>
          <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">
            <em>Opmerking: Dit is een voorbeeld. De werkelijke e-mail is verzonden naar ${booking.email}</em>
          </p>
        `;

        document.getElementById("emailPreview").innerHTML = emailContent;
        document.getElementById("emailPreview").classList.remove("hidden");
      }

      function renderBookingsOverview() {
        const container = document.getElementById("bookingsOverview");
        const bookingsList = Object.values(localData.bookings);

        if (bookingsList.length === 0) {
          container.innerHTML = "<p>Nog geen boekingen.</p>";
          return;
        }

        // Calculate email statistics
        const emailStats = {};
        bookingsList.forEach(booking => {
          const email = booking.email.toLowerCase();
          if (!emailStats[email]) {
            emailStats[email] = { count: 0, bookings: [] };
          }
          emailStats[email].count++;
          emailStats[email].bookings.push(booking);
        });

        // Create summary statistics
        const totalEmails = Object.keys(emailStats).length;
        const maxBookingsEmails = Object.values(emailStats).filter(stat => stat.count >= MAX_BOOKINGS_PER_EMAIL).length;
        
        const summaryHTML = `
          <div style="background: #f8f9fa; padding: 15px; border-radius: 4px; margin-bottom: 20px; border: 1px solid #e9ecef;">
            <h4 style="margin-bottom: 10px; color: #2c3e50;">Boekingsoverzicht</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
              <div><strong>Totale Boekingen:</strong> ${bookingsList.length}</div>
              <div><strong>Unieke E-mails:</strong> ${totalEmails}</div>
              <div><strong>Bij Max Limiet (${MAX_BOOKINGS_PER_EMAIL}):</strong> ${maxBookingsEmails}</div>
              <div><strong>Gemiddeld per E-mail:</strong> ${(bookingsList.length / totalEmails).toFixed(1)}</div>
            </div>
          </div>
        `;

        const tableHTML = `
          <table class="bookings-table">
            <thead>
              <tr>
                <th>Naam</th>
                <th>E-mail</th>
                <th>Artiest/Band</th>
                <th>Tafel</th>
                <th>Datum</th>
                <th>Tijd</th>
                <th>Sprekers</th>
                <th>E-mail Aantal</th>
                <th>Acties</th>
              </tr>
            </thead>
            <tbody>
              ${bookingsList.map((booking) => {
                const bookingKey = `${booking.tableId}-${booking.slotIndex}`;
                const emailCount = emailStats[booking.email.toLowerCase()].count;
                const isAtLimit = emailCount >= MAX_BOOKINGS_PER_EMAIL;
                
                return `
                  <tr style="${isAtLimit ? 'background-color: #fff3cd;' : ''}">
                    <td>${booking.name}</td>
                    <td>${booking.email}</td>
                    <td>${booking.artistName || "N/A"}</td>
                    <td>${booking.tableName}</td>
                    <td>${new Date(booking.date).toLocaleDateString()}</td>
                    <td>${booking.timeSlot}</td>
                    <td>${booking.speaker1} & ${booking.speaker2}</td>
                    <td style="text-align: center; ${isAtLimit ? 'font-weight: bold; color: #856404;' : ''}">${emailCount}/${MAX_BOOKINGS_PER_EMAIL}</td>
                    <td>
                      <button onclick="cancelBooking('${bookingKey}')" 
                              class="btn-danger" style="padding: 5px 10px; font-size: 12px;">
                        Annuleren
                      </button>
                    </td>
                  </tr>
                `;
              }).join("")}
            </tbody>
          </table>
        `;

        container.innerHTML = summaryHTML + tableHTML;
      }

      async function cancelBooking(bookingKey) {
        if (confirm("Weet u zeker dat u deze boeking wilt annuleren?")) {
          await removeBookingFromFirestore(bookingKey);
          
          if (!db) {
            delete localData.bookings[bookingKey];
            renderBookingsOverview();
            renderClientInterface();
            saveDataToLocalStorage();
          }
        }
      }

      function exportToCSV() {
        const bookingsList = Object.values(localData.bookings);
        if (bookingsList.length === 0) {
          showStatus("exportStatus", "Geen boekingen om te exporteren", "error");
          return;
        }

        const headers = [
          "Naam", "E-mail", "Artiest/Band", "Tafel", "Datum", "Tijd", 
          "Spreker 1", "Spreker 2", "Boekingstijd"
        ];
        
        const csvContent = [
          headers.join(","),
          ...bookingsList.map((booking) =>
            [
              booking.name,
              booking.email,
              booking.artistName || "",
              booking.tableName,
              booking.date,
              booking.timeSlot,
              booking.speaker1,
              booking.speaker2,
              new Date(booking.timestamp).toLocaleString(),
            ].map((field) => `"${field}"`).join(",")
          ),
        ].join("\n");

        downloadFile(csvContent, "gesprekstafel-boekingen.csv", "text/csv");
        showStatus("exportStatus", "CSV succesvol ge√´xporteerd", "success");
      }

async function exportToJPG() {
  const bookingsList = Object.values(localData.bookings);
  
  if (typeof html2canvas === 'undefined') {
    showStatus("exportStatus", "Afbeelding export bibliotheek niet geladen", "error");
    return;
  }

  try {
    showStatus("exportStatus", "JPG pagina's genereren voor afdrukken...", "success");
    
    // Generate event date string
    let eventDate = "Niet geconfigureerd";
    if (localData.eventConfig.date) {
      eventDate = new Date(localData.eventConfig.date).toLocaleDateString("nl-NL", {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric",
      });
    }

    // Better A4 page calculations
    const slotsPerTable = localData.eventConfig.timeSlots.length;
    const headerSpace = 120; // Header space in mm
    const summarySpace = 80; // Summary space in mm
    const tableHeaderSpace = 25; // Per table header space in mm
    const slotSpace = 18; // Per slot space in mm (increased for better scaling)
    const marginSpace = 30; // Total margins in mm
    
    // Calculate space per table
    const spacePerTable = tableHeaderSpace + (slotsPerTable * slotSpace) + 10; // 10mm margin between tables
    
    // Available space for tables (297mm A4 height - margins - header)
    const availableSpace = 297 - marginSpace - headerSpace;
    
    // Calculate tables per page (ensure at least 1 table per page)
    const tablesPerPage = Math.max(1, Math.floor(availableSpace / spacePerTable));
    
    // Split tables into pages
    const pages = [];
    for (let i = 0; i < localData.tables.length; i += tablesPerPage) {
      pages.push(localData.tables.slice(i, i + tablesPerPage));
    }
    
    // Check if summary fits on last page
    const lastPageTables = pages[pages.length - 1] || [];
    const lastPageContentSpace = headerSpace + (lastPageTables.length * spacePerTable) + summarySpace;
    
    if (lastPageContentSpace > (297 - marginSpace)) {
      pages.push([]); // Create separate page for summary
    }

    const exportContainer = document.getElementById('exportContainer');
    const dateStr = localData.eventConfig.date || new Date().toISOString().split('T')[0];
    
    // Generate each page as JPG
    for (let pageIndex = 0; pageIndex < pages.length; pageIndex++) {
      const currentPageTables = pages[pageIndex];
      const isLastPage = pageIndex === pages.length - 1;
      const totalPages = pages.length;
      
      showStatus("exportStatus", `Pagina ${pageIndex + 1} van ${totalPages} genereren...`, "success");
      
      // Create header for each page
      const headerHtml = `
        <div class="export-header">
          <div class="export-title">Gesprekstafel Boekingsschema</div>
          <div class="export-subtitle">Evenement Datum: ${eventDate}</div>
          <div class="export-subtitle">Tijd: ${localData.eventConfig.startTime} - ${localData.eventConfig.endTime}</div>
          <div class="export-subtitle">Gegenereerd: ${new Date().toLocaleString()}</div>
          <div class="export-subtitle">Pagina ${pageIndex + 1} van ${totalPages}</div>
        </div>
      `;
      
      // Create tables for current page
      const tablesHtml = currentPageTables.map((table, tableIndex) => {
        const originalIndex = localData.tables.indexOf(table);
        return `
          <div class="export-table">
            <div class="export-table-header">
              <div class="export-table-name">Tafel ${originalIndex + 1}: ${table.name}</div>
              <div class="export-table-speakers">met ${table.speaker1} & ${table.speaker2}</div>
            </div>
            <div class="export-slots">
              ${localData.eventConfig.timeSlots.map((slot) => {
                const bookingKey = `${table.id}-${slot.index}`;
                const booking = localData.bookings[bookingKey];
                
                if (booking) {
                  return `
                    <div class="export-slot booked">
                      <div class="export-time">${slot.start} - ${slot.end}</div>
                      <div class="export-booking-info booked">GEBOEKT: ${booking.name} (${booking.artistName})</div>
                    </div>
                  `;
                } else {
                  return `
                    <div class="export-slot available">
                      <div class="export-time">${slot.start} - ${slot.end}</div>
                      <div class="export-booking-info available">Beschikbaar</div>
                    </div>
                  `;
                }
              }).join('')}
            </div>
          </div>
        `;
      }).join('');
      
      // Add summary only to last page
      const summaryHtml = isLastPage ? `
        <div class="export-summary">
          <h4>Samenvatting</h4>
          <div class="export-summary-grid">
            <div class="export-summary-item"><strong>Totale Tafels:</strong> ${localData.tables.length}</div>
            <div class="export-summary-item"><strong>Totale Boekingen:</strong> ${bookingsList.length}</div>
            <div class="export-summary-item"><strong>Totale Tijdslots:</strong> ${localData.tables.length * localData.eventConfig.timeSlots.length}</div>
            <div class="export-summary-item"><strong>Beschikbare Slots:</strong> ${(localData.tables.length * localData.eventConfig.timeSlots.length) - bookingsList.length}</div>
          </div>
        </div>
      ` : '';

      // Combine all HTML for current page
      const pageHtml = headerHtml + tablesHtml + summaryHtml;
      
      // Insert content into hidden container
      exportContainer.innerHTML = pageHtml;
      
      // Position container for proper A4 rendering
      exportContainer.style.position = 'absolute';
      exportContainer.style.top = '0';
      exportContainer.style.left = '0';
      exportContainer.style.width = '210mm';
      exportContainer.style.height = '297mm';
      exportContainer.style.zIndex = '-1';
      exportContainer.style.backgroundColor = '#ffffff';
      exportContainer.style.padding = '15mm';
      exportContainer.style.boxSizing = 'border-box';
      exportContainer.style.overflow = 'hidden';
      
      // Wait for content to render
      await new Promise(resolve => setTimeout(resolve, 200));
      
      // Generate high-quality image with proper A4 dimensions
      const canvas = await html2canvas(exportContainer, {
        backgroundColor: '#ffffff',
        scale: 3, // Higher scale for better quality
        useCORS: true,
        logging: false,
        width: Math.round(210 * 3.78), // 210mm to pixels at 96 DPI * scale
        height: Math.round(297 * 3.78), // 297mm to pixels at 96 DPI * scale
        scrollX: 0,
        scrollY: 0,
        allowTaint: true,
        foreignObjectRendering: true
      });
      
      // Convert to high-quality JPG and download
      const imgData = canvas.toDataURL('image/jpeg', 0.95);
      const link = document.createElement('a');
      link.download = `gesprekstafel-schema-${dateStr}-pagina-${pageIndex + 1}.jpg`;
      link.href = imgData;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      // Delay between downloads
      await new Promise(resolve => setTimeout(resolve, 1000));
    }
    
    // Reset container
    exportContainer.style.position = 'fixed';
    exportContainer.style.top = '-9999px';
    exportContainer.style.left = '-9999px';
    exportContainer.style.width = '210mm';
    exportContainer.style.height = 'auto';
    exportContainer.style.zIndex = 'auto';
    exportContainer.style.overflow = 'visible';
    exportContainer.innerHTML = '';
    
    showStatus("exportStatus", `${pages.length} JPG pagina's succesvol ge√´xporteerd (A4 formaat, klaar voor afdrukken)`, "success");
    
  } catch (error) {
    console.error('JPG export mislukt:', error);
    showStatus("exportStatus", "JPG export mislukt: " + error.message, "error");
  }
}
      async function exportTo4KSignage() {
  const bookingsList = Object.values(localData.bookings);
  
  if (typeof html2canvas === 'undefined') {
    showStatus("exportStatus", "Afbeelding export bibliotheek niet geladen", "error");
    return;
  }

  try {
    showStatus("exportStatus", "4K signage afbeelding genereren voor TV monitors...", "success");
    
    // Generate event date string
    let eventDate = "Niet geconfigureerd";
    if (localData.eventConfig.date) {
      eventDate = new Date(localData.eventConfig.date).toLocaleDateString("nl-NL", {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric",
      });
    }

    // Create a temporary container for 4K signage
    let signageContainer = document.getElementById('signageContainer');
    if (!signageContainer) {
      signageContainer = document.createElement('div');
      signageContainer.id = 'signageContainer';
      signageContainer.className = 'signage-container';
      document.body.appendChild(signageContainer);
    }

    // Calculate statistics
    const totalSlots = localData.tables.length * localData.eventConfig.timeSlots.length;
    const bookedSlots = bookingsList.length;
    const availableSlots = totalSlots - bookedSlots;
    const occupancyRate = totalSlots > 0 ? Math.round((bookedSlots / totalSlots) * 100) : 0;

    // Create header
    const headerHtml = `
      <div class="signage-header">
        <div class="signage-title">Planning Expertenhub</div>
        <div class="signage-subtitle">${eventDate}</div>
        <div class="signage-subtitle">${localData.eventConfig.startTime} - ${localData.eventConfig.endTime}</div>
      </div>
    `;

    // Create tables grid
    const tablesHtml = `
      <div class="signage-tables-grid">
        ${localData.tables.map((table, index) => `
          <div class="signage-table">
            <div class="signage-table-header">
              <div class="signage-table-name">Tafel ${index + 1}: ${table.name}</div>
              <div class="signage-table-speakers">met ${table.speaker1} & ${table.speaker2}</div>
            </div>
            <div class="signage-slots">
              ${localData.eventConfig.timeSlots.map((slot) => {
                const bookingKey = `${table.id}-${slot.index}`;
                const booking = localData.bookings[bookingKey];
                
                if (booking) {
                  return `
                    <div class="signage-slot booked">
                      <div class="signage-time">${slot.start} - ${slot.end}</div>
                      <div class="signage-booking-info booked">${booking.name} (${booking.artistName})</div>
                    </div>
                  `;
                } else {
                  return `
                    <div class="signage-slot available">
                      <div class="signage-time">${slot.start} - ${slot.end}</div>
                      <div class="signage-booking-info available">Beschikbaar</div>
                    </div>
                  `;
                }
              }).join('')}
            </div>
          </div>
        `).join('')}
      </div>
    `;

    // Create footer with statistics
    const footerHtml = `
      <div class="signage-footer">
        <div class="signage-stats">
          <div class="signage-stat">
            <span class="signage-stat-number">${localData.tables.length}</span>
            <span>Tafels</span>
          </div>
          <div class="signage-stat">
            <span class="signage-stat-number">${bookedSlots}</span>
            <span>Geboekt</span>
          </div>
          <div class="signage-stat">
            <span class="signage-stat-number">${availableSlots}</span>
            <span>Beschikbaar</span>
          </div>
          <div class="signage-stat">
            <span class="signage-stat-number">${occupancyRate}%</span>
            <span>Bezetting</span>
          </div>
        </div>
        <div class="signage-generated">
          Gegenereerd: ${new Date().toLocaleString()}
        </div>
      </div>
    `;

    // Combine all HTML
    const signageHtml = headerHtml + tablesHtml + footerHtml;
    
    // Insert content into signage container
    signageContainer.innerHTML = signageHtml;
    
    // Position container for 4K rendering
    signageContainer.style.position = 'absolute';
    signageContainer.style.top = '0';
    signageContainer.style.left = '0';
    signageContainer.style.width = '3840px';
    signageContainer.style.height = '2160px';
    signageContainer.style.zIndex = '-1';
    
    // Wait for content to render
    await new Promise(resolve => setTimeout(resolve, 500));
    
    // Generate 4K image
    const canvas = await html2canvas(signageContainer, {
      backgroundColor: 'transparent',
      scale: 1,
      useCORS: true,
      logging: false,
      width: 3840,
      height: 2160,
      scrollX: 0,
      scrollY: 0,
      allowTaint: true,
      foreignObjectRendering: true
    });
    
    // Convert to high-quality JPG and download
    const imgData = canvas.toDataURL('image/jpeg', 0.95);
    const link = document.createElement('a');
    const dateStr = localData.eventConfig.date || new Date().toISOString().split('T')[0];
    link.download = `gesprekstafel-signage-4k-${dateStr}.jpg`;
    link.href = imgData;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    // Reset container
    signageContainer.style.position = 'fixed';
    signageContainer.style.top = '-9999px';
    signageContainer.style.left = '-9999px';
    signageContainer.style.zIndex = 'auto';
    signageContainer.innerHTML = '';
    
    showStatus("exportStatus", "4K signage afbeelding succesvol ge√´xporteerd (3840x2160, klaar voor TV monitors)", "success");
    
  } catch (error) {
    console.error('4K signage export mislukt:', error);
    showStatus("exportStatus", "4K signage export mislukt: " + error.message, "error");
  }
}
// Realtime Signage Management Functions
function openSignageDisplay() {
  // BEVEILIGING: Alleen admins kunnen signage openen
  if (!isAdminMode && !currentUser) {
    alert("Toegang geweigerd: Alleen administrators kunnen het signage scherm openen.");
    return;
  }
  
  // Genereer beveiligde signage URL
  const currentURL = window.location.href;
  const signageURL = currentURL.split('?')[0] + '?mode=signage&token=admin2025';
  
  // Open signage in nieuw tabblad/venster
  const signageWindow = window.open(
    signageURL, 
    'signage-display',
    'width=' + screen.width + ',height=' + screen.height + ',fullscreen=yes,scrollbars=no,toolbar=no,menubar=no,status=no'
  );
  
  // Focus op het nieuwe venster
  if (signageWindow) {
    signageWindow.focus();
    showSignageStatus("Signage geopend in nieuw tabblad. Sleep naar TV monitor en druk F11 voor volledig scherm.", "success");
  } else {
    // Fallback als popup geblokkeerd is
    showSignageStatus("Popup geblokkeerd door browser. Gebruik 'Kopieer Signage URL' en open handmatig in nieuw tabblad.", "warning");
  }
}

function exitSignageDisplay() {
  const signageElement = document.getElementById('signageFullscreen');
  signageElement.classList.remove('active');
  isSignageOpen = false;
  
  // Stop auto-refresh
  stopSignageAutoRefresh();
  
  showSignageStatus("4K Signage display gesloten.", "success");
}

function copySignageURL() {
  const currentURL = window.location.href;
  const signageURL = currentURL.split('?')[0] + '?mode=signage';
  
  if (navigator.clipboard) {
    navigator.clipboard.writeText(signageURL).then(() => {
      showSignageStatus("Signage URL gekopieerd naar klembord: " + signageURL, "success");
    }).catch(() => {
      fallbackCopyTextToClipboard(signageURL);
    });
  } else {
    fallbackCopyTextToClipboard(signageURL);
  }
}

function fallbackCopyTextToClipboard(text) {
  const textArea = document.createElement("textarea");
  textArea.value = text;
  textArea.style.top = "0";
  textArea.style.left = "0";
  textArea.style.position = "fixed";
  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();
  
  try {
    document.execCommand('copy');
    showSignageStatus("Signage URL gekopieerd: " + text, "success");
  } catch (err) {
    showSignageStatus("URL kopi√´ren mislukt. URL: " + text, "error");
  }
  
  document.body.removeChild(textArea);
}

function toggleSignageAutoRefresh() {
  signageAutoRefresh = !signageAutoRefresh;
  
  const statusSpan = document.getElementById('autoRefreshStatus');
  const signageBtn = document.getElementById('signageAutoRefreshBtn');
  
  if (signageAutoRefresh) {
    statusSpan.textContent = 'Auto-refresh AAN';
    if (signageBtn) signageBtn.textContent = 'Auto: ON';
    if (isSignageOpen) startSignageAutoRefresh();
    showSignageStatus("Auto-refresh ingeschakeld", "success");
  } else {
    statusSpan.textContent = 'Auto-refresh UIT';
    if (signageBtn) signageBtn.textContent = 'Auto: OFF';
    stopSignageAutoRefresh();
    showSignageStatus("Auto-refresh uitgeschakeld", "warning");
  }
}

function startSignageAutoRefresh() {
  if (!signageAutoRefresh) return;
  
  stopSignageAutoRefresh(); // Clear any existing interval
  
  const interval = parseInt(document.getElementById('signageRefreshInterval').value) * 1000;
  signageRefreshInterval = setInterval(() => {
    if (isSignageOpen && signageAutoRefresh) {
      renderSignageDisplay();
      updateSignageRefreshIndicator('updating');
      
      setTimeout(() => {
        updateSignageRefreshIndicator('live');
      }, 1000);
    }
  }, interval);
}

function stopSignageAutoRefresh() {
  if (signageRefreshInterval) {
    clearInterval(signageRefreshInterval);
    signageRefreshInterval = null;
  }
}

function refreshSignageNow() {
  if (isSignageOpen) {
    updateSignageRefreshIndicator('updating');
    renderSignageDisplay();
    
    setTimeout(() => {
      updateSignageRefreshIndicator('live');
    }, 1000);
    
    showSignageStatus("Signage handmatig ververst", "success");
  } else {
    showSignageStatus("Open eerst de signage display", "warning");
  }
}

function updateSignageRefreshIndicator(status) {
  const dot = document.getElementById('signageRefreshDot');
  const text = document.getElementById('signageRefreshText');
  
  if (status === 'updating') {
    dot.className = 'signage-refresh-dot updating';
    text.textContent = 'Updating...';
  } else {
    dot.className = 'signage-refresh-dot';
    text.textContent = 'Live';
  }
}

function renderSignageDisplay() {
  if (!isSignageOpen) return;
  
  const signageContent = document.getElementById('signageContent');
  const customTitle = document.getElementById('signageTitle').value || 'Planning Expertenhub';
  
  // Generate event date string
  let eventDate = "Niet geconfigureerd";
  if (localData.eventConfig.date) {
    eventDate = new Date(localData.eventConfig.date).toLocaleDateString("nl-NL", {
      weekday: "long",
      year: "numeric",
      month: "long",
      day: "numeric",
    });
  }

  // Calculate statistics
  const bookingsList = Object.values(localData.bookings);
  const totalSlots = localData.tables.length * localData.eventConfig.timeSlots.length;
  const bookedSlots = bookingsList.length;
  const availableSlots = totalSlots - bookedSlots;
  const occupancyRate = totalSlots > 0 ? Math.round((bookedSlots / totalSlots) * 100) : 0;

  // Create header
  const headerHtml = `
    <div class="signage-realtime-header">
      <div class="signage-realtime-title">${customTitle}</div>
      <div class="signage-realtime-subtitle">${eventDate}</div>
      <div class="signage-realtime-subtitle">${localData.eventConfig.startTime} - ${localData.eventConfig.endTime}</div>
    </div>
  `;

  // Create tables grid
  const tablesHtml = `
    <div class="signage-realtime-tables">
      ${localData.tables.map((table, index) => `
        <div class="signage-realtime-table">
          <div class="signage-realtime-table-header">
            <div class="signage-realtime-table-name">Tafel ${index + 1}: ${table.name}</div>
            <div class="signage-realtime-table-speakers">met ${table.speaker1} & ${table.speaker2}</div>
          </div>
          <div class="signage-realtime-slots">
            ${localData.eventConfig.timeSlots.map((slot) => {
              const bookingKey = `${table.id}-${slot.index}`;
              const booking = localData.bookings[bookingKey];
              
              if (booking) {
                return `
                  <div class="signage-realtime-slot booked">
                    <div class="signage-realtime-time">${slot.start} - ${slot.end}</div>
                    <div class="signage-realtime-booking-info booked">${booking.name} (${booking.artistName})</div>
                  </div>
                `;
              } else {
                return `
                  <div class="signage-realtime-slot available">
                    <div class="signage-realtime-time">${slot.start} - ${slot.end}</div>
                    <div class="signage-realtime-booking-info available">Beschikbaar</div>
                  </div>
                `;
              }
            }).join('')}
          </div>
        </div>
      `).join('')}
    </div>
  `;

  // Create footer with statistics
  const footerHtml = `
    <div class="signage-realtime-footer">
      <div class="signage-realtime-stats">
        <div class="signage-realtime-stat">
          <span class="signage-realtime-stat-number">${localData.tables.length}</span>
          <span>Tafels</span>
        </div>
        <div class="signage-realtime-stat">
          <span class="signage-realtime-stat-number">${bookedSlots}</span>
          <span>Geboekt</span>
        </div>
        <div class="signage-realtime-stat">
          <span class="signage-realtime-stat-number">${availableSlots}</span>
          <span>Beschikbaar</span>
        </div>
        <div class="signage-realtime-stat">
          <span class="signage-realtime-stat-number">${occupancyRate}%</span>
          <span>Bezetting</span>
        </div>
      </div>
      <div class="signage-realtime-generated">
        Laatste update: ${new Date().toLocaleTimeString()}
      </div>
    </div>
  `;

  // Combine all HTML
  signageContent.innerHTML = headerHtml + tablesHtml + footerHtml;
}

function showSignageStatus(message, type) {
  const element = document.getElementById('signageStatus');
  element.textContent = message;
  element.className = `status-message ${type}`;
  element.style.display = 'block';

  setTimeout(() => {
    element.style.display = 'none';
  }, 5000);
}

// Check if page should open in signage mode
function checkSignageMode() {
  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.get('mode') === 'signage') {
    // Check admin status EERST
    const adminToken = urlParams.get('token');
    const isValidAdmin = adminToken === 'admin2025' || currentUser || isAdminMode;
    
    if (!isValidAdmin) {
      // Redirect niet-admins naar normale interface
      window.location.href = window.location.href.split('?')[0];
      return;
    }
    
    // Alleen voor admins - rest blijft hetzelfde
    document.getElementById('client-interface').style.display = 'none';
    document.getElementById('admin-interface').style.display = 'none';
    
    setTimeout(() => {
      openSignageDisplay();
    }, 1000);
  }
}

// Enhanced Firebase listeners for signage updates
function setupSignageRealtimeListeners() {
  if (!db || !isFirebaseInitialized) return;

  // Listen to bookings changes and update signage if open
  const bookingsRef = db.collection('bookings');
  const unsubscribeSignageBookings = bookingsRef.onSnapshot((snapshot) => {
    snapshot.docChanges().forEach((change) => {
      if (change.type === 'added' || change.type === 'removed') {
        // New booking or cancellation - update signage immediately
        if (isSignageOpen) {
          setTimeout(() => {
            updateSignageRefreshIndicator('updating');
            renderSignageDisplay();
            
            setTimeout(() => {
              updateSignageRefreshIndicator('live');
            }, 1000);
          }, 500);
        }
      }
    });
  }, (error) => {
    console.error('Fout bij beluisteren van boekingen voor signage:', error);
  });

  unsubscribeListeners.push(unsubscribeSignageBookings);
}
      function exportToExcel() {
        const bookingsList = Object.values(localData.bookings);
        if (bookingsList.length === 0) {
          showStatus("exportStatus", "Geen boekingen om te exporteren", "error");
          return;
        }

        const excelContent = [
          "Gesprekstafel Boekingsrapport",
          `Gegenereerd op: ${new Date().toLocaleString()}`,
          `Totale Boekingen: ${bookingsList.length}`,
          `Verbindingsstatus: ${isOnline ? 'Online' : 'Offline'}`,
          "",
          "Naam,E-mail,Artiest/Band,Tafel,Datum,Tijd,Spreker 1,Spreker 2,Boekingstijd",
          ...bookingsList.map((booking) =>
            [
              booking.name,
              booking.email,
              booking.artistName || "",
              booking.tableName,
              booking.date,
              booking.timeSlot,
              booking.speaker1,
              booking.speaker2,
              new Date(booking.timestamp).toLocaleString(),
            ].map((field) => `"${field}"`).join(",")
          ),
        ].join("\n");

        downloadFile(excelContent, "gesprekstafel-boekingsrapport.csv", "text/csv");
        showStatus("exportStatus", "Excel rapport succesvol ge√´xporteerd", "success");
      }

      function downloadFile(content, filename, mimeType) {
        const blob = new Blob([content], { type: mimeType });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        a.click();
        URL.revokeObjectURL(url);
      }

      function showStatus(elementId, message, type) {
        const element = document.getElementById(elementId);
        element.textContent = message;
        element.className = `status-message ${type}`;
        element.style.display = "block";

        setTimeout(() => {
          element.style.display = "none";
        }, 5000);
      }

      // Initialize EmailJS
      (function() {
        // Load stored email configuration
        const storedEmailConfig = getStoredEmailConfig();
        if (storedEmailConfig) {
          EMAILJS_CONFIG = { ...EMAILJS_CONFIG, ...storedEmailConfig };
        }
        
        // Initialize EmailJS with the configuration
        if (typeof emailjs !== 'undefined' && EMAILJS_CONFIG.publicKey) {
          emailjs.init(EMAILJS_CONFIG.publicKey);
        }
      })();

      // Initialize application
      window.addEventListener("load", async function () {
        document.getElementById("eventDate").value = new Date().toISOString().split("T")[0];

        // Load email configuration
        loadEmailConfig();

        await initializeFirebase();
        
        document.getElementById('loadingOverlay').style.display = 'none';

        if (localData.eventConfig.timeSlots.length === 0) {
          await generateTimeSlots();
        }
// Check for signage mode
        checkSignageMode();

        document.getElementById("overlay").addEventListener("click", function (e) {
          if (e.target === this) {
            closeBookingForm();
            closeLoginModal();
            closeConfirmationModal();
            closePasswordChangeModal();
          }
        });

document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && isSignageOpen && (isAdminMode || currentUser)) {
    exitSignageDisplay();
  }
  if (e.key === 'F5' && isSignageOpen && (isAdminMode || currentUser)) {
    e.preventDefault();
    refreshSignageNow();
  }
  if (e.ctrlKey && e.key === 's' && isAdminMode && currentUser) {
    e.preventDefault();
    openSignageDisplay();
  }
});

        window.addEventListener('online', () => {
          if (isFirebaseInitialized) {
            updateConnectionStatus('connected');
            isOnline = true;
          }
        });

        window.addEventListener('offline', () => {
          updateConnectionStatus('disconnected');
          isOnline = false;
        });

      }); 

      window.addEventListener('beforeunload', () => {
        unsubscribeListeners.forEach(unsubscribe => unsubscribe());
      });
      // Check for existing login session
const storedLogin = getStoredLoginSession();
if (storedLogin && !currentUser && auth) {
  document.getElementById("adminEmail").value = storedLogin.email;
  
  auth.onAuthStateChanged((user) => {
    if (user && user.email === storedLogin.email) {
      currentUser = user;
      isAdminMode = true;
      switchToAdmin();
      
      const daysSinceLogin = Math.floor((Date.now() - storedLogin.timestamp) / (24 * 60 * 60 * 1000));
      if (storedLogin.rememberMe) {
        console.log(`Auto-ingelogd. Nog ${30 - daysSinceLogin} dagen geldig.`);
      }
    }
  });
}
    </script>
  </body>
</html>
